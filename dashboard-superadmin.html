<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>Super Administrateur – UniERP BF Premium</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <!-- Le CSS du thème est chargé dynamiquement par theme-toggle.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="js/theme-toggle.js?v=3.0"></script>
</head>

<body class="dark-theme">

    <div class="app-wrapper">
        <!-- SIDEBAR -->
        <aside class="sidebar-ultra" id="sidebar">
            <div class="sidebar-header">
                <div class="logo-ultra">
                    <div class="logo-icon-ultra">⚙️</div>
                    <div class="logo-text-ultra">
                        <div class="logo-name-ultra">UniERP BF</div>
                        <div class="logo-tag-ultra">Super Admin</div>
                    </div>
                </div>
            </div>

            <nav class="sidebar-nav-ultra">
                <div class="nav-section-ultra">
                    <div class="nav-label-ultra">Système</div>
                    <a class="nav-item-ultra active" data-page="dashboard" onclick="navToUltra('dashboard',this)">
                        <span class="nav-icon-ultra">📊</span>
                        <span class="nav-text-ultra">Vue d'ensemble</span>
                    </a>
                    <a class="nav-item-ultra" data-page="universites" onclick="navToUltra('universites',this)">
                        <span class="nav-icon-ultra">🏛️</span>
                        <span class="nav-text-ultra">Universités clientes</span>
                    </a>
                    <a class="nav-item-ultra" data-page="licences" onclick="navToUltra('licences',this)">
                        <span class="nav-icon-ultra">🔑</span>
                        <span class="nav-text-ultra">Gestion licences</span>
                    </a>
                    <a class="nav-item-ultra" data-page="monitoring" onclick="navToUltra('monitoring',this)">
                        <span class="nav-icon-ultra">📡</span>
                        <span class="nav-text-ultra">Monitoring système</span>
                    </a>
                    <a class="nav-item-ultra" data-page="utilisateurs" onclick="navToUltra('utilisateurs',this)">
                        <span class="nav-icon-ultra">👥</span>
                        <span class="nav-text-ultra">Utilisateurs globaux</span>
                    </a>
                </div>
            </nav>
        </aside>

        <!-- MAIN WRAPPER -->
        <div class="main-ultra">
            <!-- TOPBAR -->
            <header class="topbar-ultra">
                <div class="topbar-left-ultra">
                    <button class="btn-menu-ultra" onclick="toggleSidebarPremium()">☰</button>
                    <div class="search-ultra">
                        <span class="search-icon-ultra">🔍</span>
                        <input type="text" class="search-input-ultra" placeholder="Rechercher...">
                    </div>
                </div>
                <div class="topbar-right-ultra">
                    <button class="topbar-btn-ultra">
                        <span>🔔</span>
                    </button>
                    <div class="user-menu-ultra" onclick="logout()">
                        <div class="user-avatar-ultra" style="background:linear-gradient(135deg,#dc2626,#b91c1c)">SA</div>
                        <div class="user-info-ultra">
                            <div class="user-name-ultra">Super Admin</div>
                            <div class="user-role-ultra">Accès total système</div>
                        </div>
                    </div>
                </div>
            </header>

            <!-- CONTENT AREA -->
            <main class="content-ultra">

                <!-- DASHBOARD SUPER ADMIN -->
                <div class="erp-page" id="page-dashboard">
                    <div class="page-header-ultra">
                        <div class="breadcrumb">
                            <span class="breadcrumb-item">🏠 Accueil</span>
                            <span class="breadcrumb-separator">›</span>
                            <span class="breadcrumb-item">Vue d'ensemble</span>
                        </div>
                        <div class="page-title-ultra-row-ultra">
                            <div>
                                <h1 class="page-title-ultra">Vue d'ensemble</h1>
                                <p class="page-subtitle-ultra">Monitoring global du système ERP · Burkina Faso</p>
                            </div>
                            <div class="page-actions-ultra">
                                <button class="btn-ultra btn-danger">⚠️ SUPER ADMIN</button>
                            </div>
                        </div>
                    </div>

                    <!-- Global stats -->
                    <div class="stats-grid-ultra">
                        <div class="stat-card-ultra">
                            <div class="stat-card-header">
                                <div class="stat-icon-ultra danger">🏛️</div>
                                <div class="stat-trend positive">
                                    <span class="trend-icon">↑</span>
                                    <span class="trend-value">+1</span>
                                </div>
                            </div>
                            <div class="stat-value-ultra" id="stat-univs">4</div>
                            <div class="stat-label-ultra">Universités clientes</div>
                        </div>

                        <div class="stat-card-ultra">
                            <div class="stat-card-header">
                                <div class="stat-icon-ultra primary">🎓</div>
                                <div class="stat-trend positive">
                                    <span class="trend-icon">↑</span>
                                    <span class="trend-value">+340</span>
                                </div>
                            </div>
                            <div class="stat-value-ultra" id="stat-etudiants">8,260</div>
                            <div class="stat-label-ultra">Étudiants total</div>
                        </div>

                        <div class="stat-card-ultra">
                            <div class="stat-card-header">
                                <div class="stat-icon-ultra success">💰</div>
                            </div>
                            <div class="stat-value-ultra" id="stat-revenus">0 FCFA</div>
                            <div class="stat-label-ultra">Revenus SaaS</div>
                        </div>

                        <div class="stat-card-ultra">
                            <div class="stat-card-header">
                                <div class="stat-icon-ultra warning">🔑</div>
                                <div class="stat-trend negative">
                                    <span class="trend-icon">↓</span>
                                    <span class="trend-value">1 exp.</span>
                                </div>
                            </div>
                            <div class="stat-value-ultra" id="stat-licences">3</div>
                            <div class="stat-label-ultra">Licences actives</div>
                        </div>
                    </div>

                    <div style="display:grid;grid-template-columns:2fr 1fr;gap:24px;margin-bottom:24px">
                        <!-- Universités -->
                        <div class="card-ultra">
                            <div class="card-header-ultra">
                                <h3 class="card-title-ultra">🏛️ Statut des universités</h3>
                            </div>
                            <div class="card-body-ultra" style="padding:0">
                                <table class="table-ultra" id="tableUnivStatus">
                                    <thead>
                                        <tr>
                                            <th>Université</th>
                                            <th>Étudiants</th>
                                            <th>Licence</th>
                                            <th>Statut</th>
                                        </tr>
                                    </thead>
                                    <tbody id="tbodyUnivStatus"></tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Monitoring -->
                        <div class="card-ultra">
                            <div class="card-header-ultra">
                                <h3 class="card-title-ultra">📡 Santé du système</h3>
                            </div>
                            <div class="card-body-ultra" id="systemHealth"></div>
                        </div>
                    </div>

                    <!-- Revenus SaaS -->
                    <div class="card-ultra">
                        <div class="card-header-ultra">
                            <h3 class="card-title-ultra">💵 Revenus SaaS – Licences</h3>
                            <button class="btn-ultra btn-secondary-ultra" onclick="showToast('Rapport mensuel exporté','success')">📥 Exporter</button>
                        </div>
                        <div class="card-body-ultra" id="revenuChart"></div>
                    </div>
                </div>

                <!-- UNIVERSITÉS -->
                <div class="erp-page" id="page-universites" style="display:none">
                    <div class="page-header-ultra">
                        <div class="page-title-ultra-row-ultra">
                            <div>
                                <h1 class="page-title-ultra">Universités Clientes</h1>
                                <p class="page-subtitle-ultra">Gestion des établissements partenaires</p>
                            </div>
                            <div class="page-actions-ultra">
                                <button class="btn-ultra btn-primary-ultra" onclick="openModalPremium('modalUniv')">+ Nouvelle université</button>
                            </div>
                        </div>
                    </div>

                    <div class="card-ultra">
                        <div class="card-body-ultra" style="padding:0">
                            <table class="table-ultra" id="tableUniversites">
                                <thead>
                                    <tr>
                                        <th>Code</th>
                                        <th>Université</th>
                                        <th>Ville</th>
                                        <th>Étudiants</th>
                                        <th>Licence</th>
                                        <th>Expiration</th>
                                        <th>Statut</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="tbodyUniversites"></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- LICENCES -->
                <div class="erp-page" id="page-licences" style="display:none">
                    <div class="page-header-ultra">
                        <div class="page-title-ultra-row-ultra">
                            <div>
                                <h1 class="page-title-ultra">Gestion des Licences</h1>
                                <p class="page-subtitle-ultra">Plans et tarification SaaS</p>
                            </div>
                            <div class="page-actions-ultra">
                                <button class="btn-ultra btn-primary-ultra" onclick="openModalPremium('modalLicence')">+ Nouvelle licence</button>
                            </div>
                        </div>
                    </div>
                    <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(320px,1fr));gap:24px" id="licencesGrid"></div>
                </div>

                <!-- MONITORING -->
                <div class="erp-page" id="page-monitoring" style="display:none">
                    <div class="page-header-ultra">
                        <div class="page-title-ultra-row-ultra">
                            <div>
                                <h1 class="page-title-ultra">Monitoring Système</h1>
                                <p class="page-subtitle-ultra">Surveillance en temps réel</p>
                            </div>
                            <div class="page-actions-ultra">
                                <button class="btn-ultra btn-secondary-ultra" onclick="refreshMonitoring()">🔄 Rafraîchir</button>
                            </div>
                        </div>
                    </div>

                    <div class="stats-grid-ultra" id="monitorStats"></div>

                    <div style="display:grid;grid-template-columns:2fr 1fr;gap:24px;margin-top:24px">
                        <div class="card-ultra">
                            <div class="card-header-ultra">
                                <h3 class="card-title-ultra">📋 Logs système récents</h3>
                            </div>
                            <div class="card-body-ultra" style="font-family:monospace;font-size:12px;max-height:300px;overflow-y:auto;background:rgba(0,0,0,0.3);color:#10b981;border-radius:8px;padding:14px" id="systemLogs"></div>
                        </div>

                        <div class="card-ultra">
                            <div class="card-header-ultra">
                                <h3 class="card-title-ultra">💾 Sauvegardes automatiques</h3>
                            </div>
                            <div class="card-body-ultra" id="backupList"></div>
                        </div>
                    </div>
                </div>

                <!-- UTILISATEURS -->
                <div class="erp-page" id="page-utilisateurs" style="display:none">
                    <div class="page-header-ultra">
                        <div class="page-title-ultra-row-ultra">
                            <div>
                                <h1 class="page-title-ultra">Utilisateurs Globaux</h1>
                                <p class="page-subtitle-ultra">Vue d'ensemble des comptes</p>
                            </div>
                        </div>
                    </div>

                    <div class="card-ultra">
                        <div class="card-body-ultra" style="padding:0">
                            <table class="table-ultra">
                                <thead>
                                    <tr>
                                        <th>Université</th>
                                        <th>Admins</th>
                                        <th>Profs</th>
                                        <th>Étudiants</th>
                                        <th>Total</th>
                                        <th>Dernière connexion</th>
                                    </tr>
                                </thead>
                                <tbody id="tbodyUsers"></tbody>
                            </table>
                        </div>
                    </div>
                </div>

            </main>
        </div>
    </div>

    <!-- MODAL UNIVERSITÉ -->
    <div class="modal-overlay-premium" id="modalUniv">
        <div class="modal-premium">
            <div class="modal-header-premium">
                <h3 class="modal-title-premium">🏛️ Nouvelle Université</h3>
                <button class="modal-close-premium" onclick="closeModalPremium('modalUniv')">✕</button>
            </div>
            <div class="modal-body-premium">
                <div class="form-row">
                    <div class="form-group-premium">
                        <label class="form-label-premium">Code *</label>
                        <input class="form-input-premium" id="univCode" placeholder="UPN">
                    </div>
                    <div class="form-group-premium">
                        <label class="form-label-premium">Ville</label>
                        <input class="form-input-premium" id="univVille" placeholder="Ouagadougou">
                    </div>
                </div>
                <div class="form-group-premium">
                    <label class="form-label-premium">Nom complet *</label>
                    <input class="form-input-premium" id="univNom" placeholder="Université Polytechnique de...">
                </div>
                <div class="form-row">
                    <div class="form-group-premium">
                        <label class="form-label-premium">Type de licence</label>
                        <select class="form-input-premium" id="univLicence">
                            <option value="BASIC">BASIC – 50 000 FCFA/an</option>
                            <option value="STANDARD">STANDARD – 150 000 FCFA/an</option>
                            <option value="PRO">PRO – 350 000 FCFA/an</option>
                        </select>
                    </div>
                    <div class="form-group-premium">
                        <label class="form-label-premium">Expiration</label>
                        <input class="form-input-premium" type="date" id="univExpiration">
                    </div>
                </div>
            </div>
            <div class="modal-footer-premium">
                <button class="btn-ultra btn-secondary-ultra" onclick="closeModalPremium('modalUniv')">Annuler</button>
                <button class="btn-ultra btn-primary-ultra" onclick="saveUniv()">💾 Créer</button>
            </div>
        </div>
    </div>

    <!-- MODAL LICENCE -->
    <div class="modal-overlay-premium" id="modalLicence">
        <div class="modal-premium">
            <div class="modal-header-premium">
                <h3 class="modal-title-premium">🔑 Générer une Licence</h3>
                <button class="modal-close-premium" onclick="closeModalPremium('modalLicence')">✕</button>
            </div>
            <div class="modal-body-premium">
                <div class="form-group-premium">
                    <label class="form-label-premium">Université</label>
                    <select class="form-input-premium" id="licenceUniv"></select>
                </div>
                <div class="form-group-premium">
                    <label class="form-label-premium">Type</label>
                    <select class="form-input-premium" id="licenceType">
                        <option>BASIC</option>
                        <option>STANDARD</option>
                        <option>PRO</option>
                    </select>
                </div>
                <div class="form-row">
                    <div class="form-group-premium">
                        <label class="form-label-premium">Durée (mois)</label>
                        <input class="form-input-premium" type="number" id="licenceDuree" value="12">
                    </div>
                    <div class="form-group-premium">
                        <label class="form-label-premium">Expiration</label>
                        <input class="form-input-premium" type="date" id="licenceExp">
                    </div>
                </div>
                <div class="form-group-premium">
                    <label class="form-label-premium">Clé de licence générée</label>
                    <div style="background:rgba(99,102,241,0.1);border:1px solid rgba(99,102,241,0.3);border-radius:8px;padding:12px;font-family:monospace;font-size:14px;color:#818cf8;letter-spacing:1px" id="licenceKey">Cliquez sur "Générer" pour créer une clé</div>
                    <button class="btn-ultra btn-secondary-ultra" style="margin-top:12px" onclick="generateLicenceKey()">🔄 Générer clé</button>
                </div>
            </div>
            <div class="modal-footer-premium">
                <button class="btn-ultra btn-secondary-ultra" onclick="closeModalPremium('modalLicence')">Annuler</button>
                <button class="btn-ultra btn-primary-ultra" onclick="saveLicence()">✅ Activer</button>
            </div>
        </div>
    </div>

    <script>
        let currentData = { stats: null, univs: [], user: null };

        document.addEventListener('DOMContentLoaded', async () => {
            const user = requireAuth(['superadmin']);
            if (!user) return;
            currentData.user = user;

            await loadSuperAdminData();

            // Populate univ select for modals
            const univSelect = document.getElementById('licenceUniv');
            if (univSelect) {
                currentData.univs.forEach(u => {
                    univSelect.insertAdjacentHTML('beforeend', `<option value="${u.id}">${u.nom}</option>`);
                });
            }
        });

        async function loadSuperAdminData() {
            try {
                const [stats, univs] = await Promise.all([
                    API.getDashboardAdmin(),
                    API.getUniversites()
                ]);

                currentData.stats = stats;
                currentData.univs = univs;

                renderHeader();
                renderDashboard();
                renderUniversites();
                renderLicences();
                renderMonitoring();
                renderUtilisateurs();
            } catch (err) {
                showToast('Erreur de chargement', 'danger');
            }
        }

        function renderHeader() {
            const u = currentData.user;
            document.querySelector('.user-name-ultra').textContent = `${u.prenom} ${u.nom}`;
            const initials = (u.prenom?.[0] || '') + (u.nom?.[0] || '');
            document.querySelector('.user-avatar-ultra').textContent = initials || 'SA';
        }

        function navToUltra(page, el) {
            document.querySelectorAll('.erp-page').forEach(p => p.style.display = 'none');
            document.getElementById('page-' + page).style.display = 'block';
            document.querySelectorAll('.nav-item-ultra').forEach(i => i.classList.remove('active'));
            if (el) el.classList.add('active');
        }

        function toggleSidebarPremium() {
            document.getElementById('sidebar').classList.toggle('open');
        }

        function renderDashboard() {
            const s = currentData.stats;
            if (!s) return;

            document.getElementById('stat-univs').textContent = currentData.univs.length;
            document.getElementById('stat-etudiants').textContent = s.total_etudiants.toLocaleString();
            document.getElementById('stat-revenus').textContent = formatCFA(s.total_encaisse);
            document.getElementById('stat-licences').textContent = currentData.univs.length;

            document.getElementById('tbodyUnivStatus').innerHTML = currentData.univs.map(u => `
                <tr>
                  <td style="font-weight:600">${u.nom.slice(0, 30)}...</td>
                  <td><span style="background:rgba(99,102,241,0.2);color:#818cf8;padding:4px 8px;border-radius:6px;font-size:12px;font-weight:600">N/A</span></td>
                  <td><span style="background:rgba(245,158,11,0.2);color:#fbbf24;padding:4px 8px;border-radius:6px;font-size:12px;font-weight:600">PRO</span></td>
                  <td><span style="background:rgba(16,185,129,0.2);color:#10b981;padding:4px 8px;border-radius:6px;font-size:12px;font-weight:600">✓ Actif</span></td>
                </tr>`).join('');

            document.getElementById('systemHealth').innerHTML = ['API REST', 'Base de données', 'Email SMTP', 'Sauvegardes', 'Mobile Money API'].map((srv, i) => `
                <div style="display:flex;align-items:center;justify-content:space-between;padding:12px 0;border-bottom:1px solid rgba(148,163,184,0.1)">
                  <span style="font-size:14px;font-weight:500;color:#e2e8f0">${srv}</span>
                  <div style="display:flex;align-items:center;gap:8px">
                    <div style="width:8px;height:8px;border-radius:50%;background:#10b981;box-shadow:0 0 10px rgba(16,185,129,0.5)"></div>
                    <span style="font-size:12px;font-weight:600;color:#10b981">Opérationnel</span>
                  </div>
                </div>`).join('');

            document.getElementById('revenuChart').innerHTML = `
                <div style="font-size:32px;font-weight:800;color:#10b981;font-family:'Poppins',sans-serif;margin-bottom:20px;text-shadow:0 0 20px rgba(16,185,129,0.3)">
                  ${formatCFA(s.total_encaisse)}<span style="font-size:14px;font-weight:400;color:#94a3b8;margin-left:8px">total</span>
                </div>
                ${currentData.univs.slice(0, 5).map(u => `
                  <div style="display:flex;justify-content:space-between;align-items:center;padding:10px 0;border-bottom:1px solid rgba(148,163,184,0.1)">
                    <span style="font-weight:600;font-size:14px;color:#e2e8f0">${u.code}</span>
                    <span style="font-weight:700;color:#10b981">Actif</span>
                  </div>`).join('')}`;
        }

        function renderUniversites() {
            document.getElementById('tbodyUniversites').innerHTML = currentData.univs.map(u => `
                <tr>
                  <td style="font-family:monospace;font-weight:600">${u.code}</td>
                  <td style="font-weight:600">${u.nom}</td>
                  <td>${u.ville}</td>
                  <td><span style="background:rgba(99,102,241,0.2);color:#818cf8;padding:4px 8px;border-radius:6px;font-size:12px;font-weight:600">N/A</span></td>
                  <td><span style="background:rgba(245,158,11,0.2);color:#fbbf24;padding:4px 8px;border-radius:6px;font-size:12px;font-weight:600">PRO</span></td>
                  <td style="font-size:13px">Illimité</td>
                  <td><span style="background:rgba(16,185,129,0.2);color:#10b981;padding:4px 8px;border-radius:6px;font-size:12px;font-weight:600">✓ Actif</span></td>
                  <td><div style="display:flex;gap:8px">
                    <button class="btn-ultra btn-secondary-ultra" style="padding:6px 12px;font-size:13px" onclick="showToast('Admin accès simulé','info')">🔑 Accéder</button>
                    <button class="btn-ultra btn-secondary-ultra" style="padding:6px 12px;font-size:13px" onclick="toggleUniv(${u.id})">⏸️</button>
                  </div></td>
                </tr>`).join('');
        }

        function toggleUniv(id) { showToast('Action restreinte', 'warning'); }

        async function saveUniv() {
            const nom = document.getElementById('univNom').value.trim();
            const code = document.getElementById('univCode').value.trim();
            const ville = document.getElementById('univVille').value.trim();
            if (!nom || !code) { showToast('Nom et code requis', 'warning'); return; }
            try {
                await API.createUniversite({ nom, code, ville });
                closeModalPremium('modalUniv');
                await loadSuperAdminData();
                showToast('Université créée', 'success');
            } catch (err) { showToast(err.message, 'danger'); }
        }

        function renderLicences() {
            const types = {
                BASIC: { prix: '50 000 FCFA/an', couleur: '#64748b', cap: '≤ 500 étudiants', foncs: ['Gestion de base', 'Notes & bulletins', 'Rapport minimal'] },
                STANDARD: { prix: '150 000 FCFA/an', couleur: '#6366f1', cap: '≤ 2 000 étudiants', foncs: ['Toutes fonctions BASIC', 'Gestion financière', 'Export Excel & PDF'] },
                PRO: { prix: '350 000 FCFA/an', couleur: '#f59e0b', cap: 'Illimité', foncs: ['Toutes fonctions STANDARD', 'Mobile Money intégré', 'API REST & Webhooks', 'Support prioritaire 24/7'] },
            };
            document.getElementById('licencesGrid').innerHTML = Object.entries(types).map(([key, t]) => `
                <div class="card-ultra" style="border-top:3px solid ${t.couleur}">
                  <div class="card-body-ultra">
                    <div style="font-size:24px;font-weight:800;color:${t.couleur};font-family:'Poppins',sans-serif;margin-bottom:6px;text-shadow:0 0 20px ${t.couleur}40">${key}</div>
                    <div style="font-size:20px;font-weight:700;margin-bottom:6px;color:#e2e8f0">${t.prix}</div>
                    <div style="font-size:12px;color:#94a3b8;margin-bottom:16px">${t.cap}</div>
                    ${t.foncs.map(f => `<div style="font-size:13px;margin-bottom:8px;display:flex;gap:8px;color:#cbd5e1"><span style="color:${t.couleur}">✓</span>${f}</div>`).join('')}
                    <div style="margin-top:20px;padding-top:16px;border-top:1px solid rgba(148,163,184,0.1)">
                        <button class="btn-ultra btn-secondary-ultra w-full" onclick="openModalPremium('modalLicence')">Gérer les clés</button>
                    </div>
                  </div>
                </div>`).join('');
        }

        function generateLicenceKey() {
            const type = document.getElementById('licenceType').value || 'PRO';
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            const rand = n => [...Array(n)].map(() => chars[Math.floor(Math.random() * chars.length)]).join('');
            document.getElementById('licenceKey').textContent = `ERP-${type}-${rand(4)}-${rand(4)}-${rand(8)}-2025`;
        }

        function saveLicence() { closeModalPremium('modalLicence'); showToast('Clé activée', 'success'); }

        function renderMonitoring() {
            document.getElementById('monitorStats').innerHTML = [
                { icon: '⚡', val: '100%', lbl: 'Disponibilité', cls: 'success' },
                { icon: '⏱️', val: '92ms', lbl: 'Réponse API', cls: '' },
                { icon: '👥', val: 'Connecté', lbl: 'Statut Session', cls: 'primary' },
                { icon: '💾', val: 'Active', lbl: 'Base de données', cls: 'warning' },
            ].map(s => `
                <div class="stat-card-ultra">
                    <div class="stat-card-header">
                        <div class="stat-icon-ultra ${s.cls}">${s.icon}</div>
                    </div>
                    <div class="stat-value-ultra" style="font-size:24px">${s.val}</div>
                    <div class="stat-label-ultra">${s.lbl}</div>
                </div>`).join('');

            document.getElementById('systemLogs').innerHTML = `<div style="margin-bottom:6px"><span style="color:#64748b">[${new Date().toLocaleTimeString()}]</span> <span style="color:#10b981">[OK]</span> Dashboard chargé avec succès.</div>`;
            document.getElementById('backupList').innerHTML = `<div style="display:flex;align-items:center;justify-content:space-between;padding:12px 0;border-bottom:1px solid rgba(148,163,184,0.1)"><div><div style="font-size:13px;font-weight:600;color:#e2e8f0">Dernier backup system</div><div style="font-size:11px;color:#94a3b8">${new Date().toLocaleDateString()}</div></div><span style="background:rgba(16,185,129,0.2);color:#10b981;padding:4px 8px;border-radius:6px;font-size:12px;font-weight:600">✓</span></div>`;
        }

        function refreshMonitoring() { renderMonitoring(); showToast('Données actualisées', 'success'); }

        function renderUtilisateurs() {
            document.getElementById('tbodyUsers').innerHTML = currentData.univs.map(u => `
                <tr>
                  <td style="font-weight:600">${u.nom}</td>
                  <td><span style="background:rgba(99,102,241,0.2);color:#818cf8;padding:4px 8px;border-radius:6px;font-size:12px;font-weight:600">${u.code}</span></td>
                  <td>—</td>
                  <td>—</td>
                  <td style="font-weight:600">Admin Univ</td>
                  <td style="font-size:13px;color:#94a3b8">Actif</td>
                </tr>`).join('');
        }

        function logout() { if (confirm('Se déconnecter ?')) { API.logout(); } }
        function openModalPremium(id) { document.getElementById(id).classList.add('open'); document.body.style.overflow = 'hidden'; }
        function closeModalPremium(id) { document.getElementById(id).classList.remove('open'); document.body.style.overflow = ''; }
        
        function showToast(message, type = 'info') {
            console.log(`[${type.toUpperCase()}] ${message}`);
            alert(message);
        }

        function formatCFA(montant) {
            return new Intl.NumberFormat('fr-FR').format(montant) + ' FCFA';
        }
    </script>
    
    <script src="js/mock-data.js"></script>
    <script src="js/api.js"></script>
    <script src="js/fix-navigation.js"></script>
    <script src="js/theme-toggle.js?v=3.0"></script>
</body>

</html>