<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>√âtudiant ‚Äì ERP Universitaire</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Outfit:wght@400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/dashboard-premium.css?v=12">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>
<body class="dark-theme">

    <div class="app-container">
        <!-- SIDEBAR -->
        <aside class="sidebar-premium" id="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-logo" style="background:linear-gradient(135deg,#F59E0B,#D97706);box-shadow:0 0 30px rgba(245,158,11,0.4)">üéì</div>
                <div class="sidebar-brand">
                    <div class="sidebar-brand-name">UniERP BF</div>
                    <div class="sidebar-brand-tagline">Espace √âtudiant</div>
                </div>
            </div>

            <nav class="sidebar-nav">
                <div class="nav-section">
                    <div class="nav-section-label">Principal</div>
                    <a class="nav-item-premium active" data-page="dashboard" onclick="navToPremium('dashboard',this)">
                        <span class="nav-icon">üìä</span>
                        <span class="nav-text">Tableau de bord</span>
                    </a>
                </div>

                <div class="nav-section">
                    <div class="nav-section-label">Acad√©mique</div>
                    <a class="nav-item-premium" data-page="notes" onclick="navToPremium('notes',this)">
                        <span class="nav-icon">üìù</span>
                        <span class="nav-text">Mes notes</span>
                    </a>
                    <a class="nav-item-premium" data-page="emploi" onclick="navToPremium('emploi',this)">
                        <span class="nav-icon">üìÖ</span>
                        <span class="nav-text">Emploi du temps</span>
                    </a>
                    <a class="nav-item-premium" data-page="enseignants" onclick="navToPremium('enseignants',this)">
                        <span class="nav-icon">üë®‚Äçüè´</span>
                        <span class="nav-text">Mes enseignants</span>
                    </a>
                    <a class="nav-item-premium" data-page="absence" onclick="navToPremium('absence',this)">
                        <span class="nav-icon">üìã</span>
                        <span class="nav-text">Absences</span>
                    </a>
                    <a class="nav-item-premium" data-page="cours" onclick="navToPremium('cours',this)">
                        <span class="nav-icon">üìö</span>
                        <span class="nav-text">Cours</span>
                    </a>
                    <a class="nav-item-premium" data-page="supports" onclick="navToPremium('supports',this)">
                        <span class="nav-icon">üìÑ</span>
                        <span class="nav-text">Supports de cours</span>
                    </a>
                    <a class="nav-item-premium" data-page="evaluation" onclick="navToPremium('evaluation',this)">
                        <span class="nav-icon">‚úçÔ∏è</span>
                        <span class="nav-text">√âvaluations</span>
                    </a>
                </div>

                <div class="nav-section">
                    <div class="nav-section-label">Services</div>
                    <a class="nav-item-premium" data-page="demande" onclick="navToPremium('demande',this)">
                        <span class="nav-icon">üì®</span>
                        <span class="nav-text">Demandes</span>
                    </a>
                    <a class="nav-item-premium" data-page="reclamation" onclick="navToPremium('reclamation',this)">
                        <span class="nav-icon">üì¢</span>
                        <span class="nav-text">R√©clamations</span>
                    </a>
                    <a class="nav-item-premium" data-page="publications" onclick="navToPremium('publications',this)">
                        <span class="nav-icon">üì∞</span>
                        <span class="nav-text">Publications</span>
                    </a>
                    <a class="nav-item-premium" data-page="sondage" onclick="navToPremium('sondage',this)">
                        <span class="nav-icon">üìä</span>
                        <span class="nav-text">Sondages</span>
                    </a>
                    <a class="nav-item-premium" data-page="questionnaire" onclick="navToPremium('questionnaire',this)">
                        <span class="nav-icon">üìù</span>
                        <span class="nav-text">Questionnaires</span>
                    </a>
                    <a class="nav-item-premium" data-page="objetperdu" onclick="navToPremium('objetperdu',this)">
                        <span class="nav-icon">üîç</span>
                        <span class="nav-text">Objets perdus</span>
                    </a>
                </div>

                <div class="nav-section">
                    <div class="nav-section-label">Finance</div>
                    <a class="nav-item-premium" data-page="paiements" onclick="navToPremium('paiements',this)">
                        <span class="nav-icon">üí∞</span>
                        <span class="nav-text">Mes paiements</span>
                    </a>
                </div>
            </nav>
        </aside>

        <!-- MAIN WRAPPER -->
        <div class="main-wrapper">
            <!-- TOPBAR -->
            <header class="topbar-premium">
                <div class="topbar-left">
                    <button class="btn-menu-toggle" onclick="toggleSidebarPremium()">‚ò∞</button>
                    <div class="search-bar">
                        <span class="search-icon">üîç</span>
                        <input type="text" class="search-input" placeholder="Rechercher...">
                    </div>
                </div>
                <div class="topbar-right">
                    <button class="topbar-action">
                        <span>üîî</span>
                    </button>
                    <div class="user-menu" onclick="logout()">
                        <div class="user-avatar" style="background:linear-gradient(135deg,#F59E0B,#D97706)">ET</div>
                        <div class="user-info">
                            <div class="user-name">√âtudiant</div>
                            <div class="user-role">√âtudiant</div>
                        </div>
                    </div>
                </div>
            </header>

            <!-- CONTENT AREA -->
            <main class="content-area">
                <!-- PAGE: DASHBOARD -->
                <div class="erp-page" id="page-dashboard">
                    <div class="page-header">
                        <div class="breadcrumb">
                            <span class="breadcrumb-item">üè† Accueil</span>
                            <span class="breadcrumb-separator">‚Ä∫</span>
                            <span class="breadcrumb-item">Tableau de bord</span>
                        </div>
                        <div class="page-title-row">
                            <div>
                                <h1 class="page-title">Tableau de bord</h1>
                                <p class="page-subtitle">Espace √©tudiant ¬∑ Ann√©e 2024-2025</p>
                            </div>
                        </div>
                    </div>

                    <!-- STATS CARDS -->
                    <div class="stats-grid">
                        <div class="stat-card-premium">
                            <div class="stat-card-header">
                                <div class="stat-icon-wrapper warning">üìö</div>
                            </div>
                            <div class="stat-value" id="statMatieres">0</div>
                            <div class="stat-label">Mati√®res inscrites</div>
                        </div>

                        <div class="stat-card-premium">
                            <div class="stat-card-header">
                                <div class="stat-icon-wrapper success">üìä</div>
                            </div>
                            <div class="stat-value" id="statMoyenne">0.00</div>
                            <div class="stat-label">Moyenne g√©n√©rale</div>
                        </div>

                        <div class="stat-card-premium">
                            <div class="stat-card-header">
                                <div class="stat-icon-wrapper primary">‚úÖ</div>
                            </div>
                            <div class="stat-value" id="statPresence">0%</div>
                            <div class="stat-label">Taux de pr√©sence</div>
                        </div>

                        <div class="stat-card-premium">
                            <div class="stat-card-header">
                                <div class="stat-icon-wrapper danger">üí∞</div>
                            </div>
                            <div class="stat-value" id="statSolde">0 FCFA</div>
                            <div class="stat-label">Solde d√ª</div>
                        </div>
                    </div>

                    <!-- CONTENT CARDS -->
                    <div style="display:grid;grid-template-columns:2fr 1fr;gap:24px;margin-bottom:24px">
                        <div class="card-premium">
                            <div class="card-header-premium">
                                <h3 class="card-title-premium">üìà √âvolution de vos notes</h3>
                            </div>
                            <div class="card-body-premium">
                                <canvas id="chartNotes" height="80"></canvas>
                            </div>
                        </div>

                        <div class="card-premium">
                            <div class="card-header-premium">
                                <h3 class="card-title-premium">üéØ R√©partition</h3>
                            </div>
                            <div class="card-body-premium">
                                <canvas id="chartRepartition" height="200"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- RECENT NOTES -->
                    <div class="card-premium">
                        <div class="card-header-premium">
                            <h3 class="card-title-premium">üìù Notes r√©centes</h3>
                            <button class="btn-premium btn-outline" onclick="navToPremium('notes')">Voir tout</button>
                        </div>
                        <div class="card-body-premium" style="padding:0">
                            <table class="table-premium">
                                <thead>
                                    <tr>
                                        <th>Mati√®re</th>
                                        <th>CC</th>
                                        <th>Examen</th>
                                        <th>Moyenne</th>
                                        <th>Statut</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                <tbody id="tbodyNotes">
                                    <tr><td colspan="6" style="text-align:center;padding:40px">Chargement...</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- PAGE: NOTES -->
                <div class="erp-page" id="page-notes" style="display:none">
                    <div class="page-header">
                        <div class="page-title-row">
                            <div>
                                <h1 class="page-title">Mes notes</h1>
                                <p class="page-subtitle">Consultez vos r√©sultats acad√©miques</p>
                            </div>
                            <div class="page-actions">
                                <button class="btn-premium btn-outline">üì• T√©l√©charger bulletin</button>
                            </div>
                        </div>
                    </div>

                    <div class="card-premium">
                        <div class="card-body-premium" style="padding:0">
                            <table class="table-premium">
                                <thead>
                                    <tr>
                                        <th>Mati√®re</th>
                                        <th>Coefficient</th>
                                        <th>CC</th>
                                        <th>Examen</th>
                                        <th>Moyenne</th>
                                        <th>Statut</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                <tbody id="tbodyNotesComplete">
                                    <tr><td colspan="7" style="text-align:center;padding:40px">Chargement...</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- PAGE: EMPLOI -->
                <div class="erp-page" id="page-emploi" style="display:none">
                    <div class="page-header">
                        <div class="page-title-row">
                            <div>
                                <h1 class="page-title">Emploi du temps</h1>
                                <p class="page-subtitle">Votre programme de la semaine</p>
                            </div>
                            <div class="page-actions">
                                <button class="btn-premium btn-outline" onclick="imprimerEmploi()">üñ®Ô∏è Imprimer</button>
                            </div>
                        </div>
                    </div>

                    <div class="card-premium">
                        <div class="card-body-premium">
                            <div style="overflow-x:auto">
                                <table class="table-premium">
                                    <thead>
                                        <tr>
                                            <th>Jour</th>
                                            <th>Heure</th>
                                            <th>Mati√®re</th>
                                            <th>Enseignant</th>
                                            <th>Salle</th>
                                            <th>Type</th>
                                        </tr>
                                    </thead>
                                    <tbody id="tbodyEmploi">
                                        <tr><td colspan="6" style="text-align:center;padding:40px">Chargement...</td></tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- PAGE: MES ENSEIGNANTS -->
                <div class="erp-page" id="page-enseignants" style="display:none">
                    <div class="page-header">
                        <div class="page-title-row">
                            <div>
                                <h1 class="page-title">üë®‚Äçüè´ Mes enseignants</h1>
                                <p class="page-subtitle">Liste de vos enseignants et leurs mati√®res</p>
                            </div>
                        </div>
                    </div>

                    <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(320px,1fr));gap:20px" id="listeEnseignants">
                        <p style="text-align:center;padding:60px;color:rgba(255,255,255,0.5);grid-column:1/-1">Chargement...</p>
                    </div>
                </div>

                <!-- PAGE: SUPPORTS -->
                <div class="erp-page" id="page-supports" style="display:none">
                    <div class="page-header">
                        <div class="page-title-row">
                            <div>
                                <h1 class="page-title">Supports de cours</h1>
                                <p class="page-subtitle">Documents p√©dagogiques mis √† disposition par vos enseignants</p>
                            </div>
                        </div>
                    </div>

                    <!-- Filtres -->
                    <div class="card-premium" style="margin-bottom:24px">
                        <div class="card-body-premium">
                            <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:16px">
                                <div>
                                    <input type="text" id="searchSupports" class="search-input-ultra" placeholder="üîç Rechercher..." 
                                        style="width:100%;padding:12px 16px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:10px;color:#fff"
                                        onkeyup="filtrerSupports()">
                                </div>
                                <div>
                                    <select id="filterTypeSupport" class="form-input-premium" onchange="filtrerSupports()" style="width:100%;padding:12px 16px">
                                        <option value="">üìÑ Tous les types</option>
                                        <option value="cours">Cours magistral</option>
                                        <option value="td">TD</option>
                                        <option value="tp">TP</option>
                                        <option value="examen_corrige">Examen corrig√©</option>
                                        <option value="ressource">Ressource</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Liste des supports -->
                    <div class="card-premium">
                        <div class="card-body-premium">
                            <div style="overflow-x:auto">
                                <table class="table-premium">
                                    <thead>
                                        <tr>
                                            <th>Titre</th>
                                            <th>Mati√®re</th>
                                            <th>Enseignant</th>
                                            <th>Type</th>
                                            <th>Date</th>
                                            <th>Action</th>
                                        </tr>
                                    </thead>
                                    <tbody id="tbodySupports">
                                        <tr><td colspan="6" style="text-align:center;padding:40px">Chargement...</td></tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- PAGE: PAIEMENTS -->
                <div class="erp-page" id="page-paiements" style="display:none">
                    <div class="page-header">
                        <div class="page-title-row">
                            <div>
                                <h1 class="page-title">Mes paiements</h1>
                                <p class="page-subtitle">Historique de vos paiements et situation financi√®re</p>
                            </div>
                        </div>
                    </div>

                    <!-- Situation financi√®re -->
                    <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:16px;margin-bottom:24px">
                        <div style="padding:20px;background:rgba(16,185,129,0.1);border-radius:12px;border:1px solid rgba(16,185,129,0.2)">
                            <div style="font-size:12px;color:rgba(255,255,255,0.6);margin-bottom:8px">FRAIS D'INSCRIPTION</div>
                            <div style="font-size:24px;font-weight:700;color:#10b981" id="statFraisInscription">0 FCFA</div>
                        </div>
                        <div style="padding:20px;background:rgba(99,102,241,0.1);border-radius:12px;border:1px solid rgba(99,102,241,0.2)">
                            <div style="font-size:12px;color:rgba(255,255,255,0.6);margin-bottom:8px">MONTANT PAY√â</div>
                            <div style="font-size:24px;font-weight:700;color:#6366f1" id="statMontantPaye">0 FCFA</div>
                        </div>
                        <div style="padding:20px;background:rgba(239,68,68,0.1);border-radius:12px;border:1px solid rgba(239,68,68,0.2)">
                            <div style="font-size:12px;color:rgba(255,255,255,0.6);margin-bottom:8px">SOLDE D√õ</div>
                            <div style="font-size:24px;font-weight:700;color:#ef4444" id="statSoldeDu">0 FCFA</div>
                        </div>
                    </div>

                    <!-- Historique des paiements -->
                    <div class="card-premium">
                        <div class="card-header-premium">
                            <h3 class="card-title-premium">üí∞ Historique des paiements</h3>
                        </div>
                        <div class="card-body-premium">
                            <div style="overflow-x:auto">
                                <table class="table-premium">
                                    <thead>
                                        <tr>
                                            <th>N¬∞ Re√ßu</th>
                                            <th>Date</th>
                                            <th>Montant</th>
                                            <th>Mode</th>
                                            <th>Type</th>
                                            <th>Statut</th>
                                            <th>Action</th>
                                        </tr>
                                    </thead>
                                    <tbody id="tbodyPaiements">
                                        <tr><td colspan="7" style="text-align:center;padding:40px">Chargement...</td></tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- PAGE: ABSENCE -->
                <div class="erp-page" id="page-absence" style="display:none">
                    <div class="page-header">
                        <h1 class="page-title">üìã Mes absences</h1>
                        <p class="page-subtitle">Suivi de vos absences et pr√©sences</p>
                    </div>
                    
                    <!-- Stats absences -->
                    <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:16px;margin-bottom:24px">
                        <div class="stat-card-ultra success-ultra">
                            <div class="stat-icon-ultra">‚úÖ</div>
                            <div class="stat-content-ultra">
                                <div class="stat-value-ultra" id="statPresences">0</div>
                                <div class="stat-label-ultra">Pr√©sences</div>
                            </div>
                        </div>
                        <div class="stat-card-ultra warning-ultra">
                            <div class="stat-icon-ultra">‚ö†Ô∏è</div>
                            <div class="stat-content-ultra">
                                <div class="stat-value-ultra" id="statAbsences">0</div>
                                <div class="stat-label-ultra">Absences</div>
                            </div>
                        </div>
                        <div class="stat-card-ultra primary-ultra">
                            <div class="stat-icon-ultra">üìä</div>
                            <div class="stat-content-ultra">
                                <div class="stat-value-ultra" id="statTauxPresence">0%</div>
                                <div class="stat-label-ultra">Taux de pr√©sence</div>
                            </div>
                        </div>
                    </div>

                    <div class="card-premium">
                        <div class="card-header-premium">
                            <h3 class="card-title-premium">Historique des absences</h3>
                        </div>
                        <div class="card-body-premium" style="padding:0">
                            <table class="table-ultra">
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>Mati√®re</th>
                                        <th>Type</th>
                                        <th>Statut</th>
                                        <th>Justification</th>
                                    </tr>
                                </thead>
                                <tbody id="tbodyAbsences">
                                    <tr><td colspan="5" style="text-align:center;padding:40px">Aucune absence enregistr√©e</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- PAGE: COURS -->
                <div class="erp-page" id="page-cours" style="display:none">
                    <div class="page-header">
                        <h1 class="page-title">üìö Mes cours</h1>
                        <p class="page-subtitle">Liste de vos cours et mati√®res</p>
                    </div>
                    
                    <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:20px">
                        <div id="listeCours">
                            <p style="text-align:center;padding:60px;color:rgba(255,255,255,0.5)">Chargement...</p>
                        </div>
                    </div>
                </div>

                <!-- PAGE: EVALUATION -->
                <div class="erp-page" id="page-evaluation" style="display:none">
                    <div class="page-header">
                        <h1 class="page-title">‚úçÔ∏è √âvaluations</h1>
                        <p class="page-subtitle">Calendrier des √©valuations et examens</p>
                    </div>
                    
                    <div class="card-premium">
                        <div class="card-header-premium">
                            <h3 class="card-title-premium">Prochaines √©valuations</h3>
                        </div>
                        <div class="card-body-premium" style="padding:0">
                            <table class="table-ultra">
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>Mati√®re</th>
                                        <th>Type</th>
                                        <th>Dur√©e</th>
                                        <th>Salle</th>
                                    </tr>
                                </thead>
                                <tbody id="tbodyEvaluations">
                                    <tr><td colspan="5" style="text-align:center;padding:40px">Aucune √©valuation programm√©e</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- PAGE: DEMANDE -->
                <div class="erp-page" id="page-demande" style="display:none">
                    <div class="page-header">
                        <div>
                            <h1 class="page-title">üì® Mes demandes</h1>
                            <p class="page-subtitle">Soumettre et suivre vos demandes administratives et p√©dagogiques</p>
                        </div>
                        <button class="btn-premium btn-primary" onclick="openModalDemande()">+ Nouvelle demande</button>
                    </div>
                    
                    <div class="card-premium">
                        <div class="card-body-premium" style="padding:0">
                            <table class="table-premium">
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>Destinataire</th>
                                        <th>Type</th>
                                        <th>Objet</th>
                                        <th>Statut</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="tbodyDemandes">
                                    <tr><td colspan="6" style="text-align:center;padding:40px">Chargement...</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- PAGE: PUBLICATIONS -->
                <div class="erp-page" id="page-publications" style="display:none">
                    <div class="page-header">
                        <h1 class="page-title">üì∞ Publications</h1>
                        <p class="page-subtitle">Actualit√©s et annonces de l'universit√©</p>
                    </div>
                    
                    <div id="listePublications" style="display:grid;gap:20px">
                        <p style="text-align:center;padding:60px;color:rgba(255,255,255,0.5)">Chargement...</p>
                    </div>
                </div>

                <!-- PAGE: SONDAGE -->
                <div class="erp-page" id="page-sondage" style="display:none">
                    <div class="page-header">
                        <h1 class="page-title">üìä Sondages</h1>
                        <p class="page-subtitle">Participez aux sondages de l'universit√©</p>
                    </div>
                    
                    <div id="listeSondages" style="display:grid;gap:20px">
                        <p style="text-align:center;padding:60px;color:rgba(255,255,255,0.5)">Chargement...</p>
                    </div>
                </div>

                <!-- PAGE: QUESTIONNAIRE -->
                <div class="erp-page" id="page-questionnaire" style="display:none">
                    <div class="page-header">
                        <h1 class="page-title">üìù Questionnaires</h1>
                        <p class="page-subtitle">√âvaluez vos enseignants et cours</p>
                    </div>
                    
                    <div id="listeQuestionnaires" style="display:grid;gap:20px">
                        <p style="text-align:center;padding:60px;color:rgba(255,255,255,0.5)">Chargement...</p>
                    </div>
                </div>

                <!-- PAGE: RECLAMATION -->
                <div class="erp-page" id="page-reclamation" style="display:none">
                    <div class="page-header">
                        <div>
                            <h1 class="page-title">üì¢ Mes r√©clamations</h1>
                            <p class="page-subtitle">Suivez vos r√©clamations sur les notes</p>
                        </div>
                        <button class="btn-premium btn-primary" onclick="openModalReclamation()">+ Nouvelle r√©clamation</button>
                    </div>
                    
                    <div class="card-premium">
                        <div class="card-body-premium" style="padding:0">
                            <table class="table-premium">
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>Mati√®re</th>
                                        <th>Type de probl√®me</th>
                                        <th>Description</th>
                                        <th>Statut</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="tbodyReclamations">
                                    <tr><td colspan="6" style="text-align:center;padding:40px">Chargement...</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- PAGE: OBJET PERDU -->
                <div class="erp-page" id="page-objetperdu" style="display:none">
                    <div class="page-header">
                        <div>
                            <h1 class="page-title">üîç Objets perdus</h1>
                            <p class="page-subtitle">D√©clarer ou rechercher des objets perdus</p>
                        </div>
                        <button class="btn-premium btn-primary" onclick="openModalObjetPerdu()">+ D√©clarer un objet</button>
                    </div>
                    
                    <div class="card-premium">
                        <div class="card-body-premium" style="padding:0">
                            <table class="table-premium">
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>Objet</th>
                                        <th>Description</th>
                                        <th>Lieu</th>
                                        <th>Type</th>
                                        <th>Statut</th>
                                    </tr>
                                </thead>
                                <tbody id="tbodyObjetsPerdu">
                                    <tr><td colspan="6" style="text-align:center;padding:40px">Chargement...</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- MODAL R√âCLAMATION NOTE -->
    <div class="modal-overlay-premium" id="modalReclamation" style="display:none">
        <div class="modal-premium">
            <div class="modal-header-premium">
                <h3 class="modal-title-premium">‚ö†Ô∏è Signaler un probl√®me sur une note</h3>
                <button class="modal-close-premium" onclick="closeModalReclamation()">‚úï</button>
            </div>
            <form onsubmit="soumettreReclamation(event)">
                <div class="modal-body-premium">
                    <div class="alert-info-premium" style="background:rgba(245,158,11,0.1);border:1px solid rgba(245,158,11,0.3);border-radius:10px;padding:14px;margin-bottom:20px;color:#fbbf24;font-size:13px;">
                        ‚ö†Ô∏è Cette r√©clamation sera envoy√©e √† l'enseignant pour v√©rification. Assurez-vous de bien d√©crire le probl√®me.
                    </div>
                    
                    <input type="hidden" id="reclamationNoteId" name="note_id">
                    
                    <!-- S√©lecteur de note (visible uniquement si ouvert depuis l'onglet r√©clamations) -->
                    <div class="form-group-premium" id="groupeSelectNote" style="display:none">
                        <label class="form-label-premium">S√©lectionner la note concern√©e *</label>
                        <select id="reclamationSelectNote" class="form-input-premium" onchange="updateNoteReclamation()">
                            <option value="">Chargement...</option>
                        </select>
                    </div>
                    
                    <div class="form-group-premium" id="groupeMatiereReadonly">
                        <label class="form-label-premium">Mati√®re concern√©e</label>
                        <input type="text" class="form-input-premium" id="reclamationMatiere" readonly style="background:rgba(255,255,255,0.03);">
                    </div>

                    <div class="form-row" style="display:grid;grid-template-columns:1fr 1fr;gap:16px;">
                        <div class="form-group-premium">
                            <label class="form-label-premium">Note CC actuelle</label>
                            <input type="text" class="form-input-premium" id="reclamationCC" readonly style="background:rgba(255,255,255,0.03);">
                        </div>
                        <div class="form-group-premium">
                            <label class="form-label-premium">Note Examen actuelle</label>
                            <input type="text" class="form-input-premium" id="reclamationExamen" readonly style="background:rgba(255,255,255,0.03);">
                        </div>
                    </div>

                    <div class="form-group-premium">
                        <label class="form-label-premium">Type de probl√®me *</label>
                        <select name="type_probleme" required class="form-input-premium">
                            <option value="">S√©lectionner</option>
                            <option value="note_incorrecte">Note incorrecte / erreur de saisie</option>
                            <option value="note_manquante">Note manquante</option>
                            <option value="mauvaise_matiere">Note attribu√©e √† la mauvaise mati√®re</option>
                            <option value="calcul_errone">Erreur de calcul de moyenne</option>
                            <option value="autre">Autre probl√®me</option>
                        </select>
                    </div>

                    <div class="form-group-premium">
                        <label class="form-label-premium">Description du probl√®me *</label>
                        <textarea name="description" required class="form-input-premium" rows="4" placeholder="D√©crivez pr√©cis√©ment le probl√®me constat√©..."></textarea>
                    </div>

                    <div class="form-group-premium">
                        <label class="form-label-premium">Note correcte attendue (si applicable)</label>
                        <input type="text" name="note_attendue" class="form-input-premium" placeholder="Ex: CC: 15/20, Examen: 14/20">
                    </div>
                </div>
                <div class="modal-footer-premium">
                    <button type="button" class="btn-premium btn-outline" onclick="closeModalReclamation()">Annuler</button>
                    <button type="submit" class="btn-premium btn-primary" style="background:linear-gradient(135deg,#f59e0b,#d97706)">üì§ Envoyer la r√©clamation</button>
                </div>
            </form>
        </div>
    </div>

    <!-- MODAL DEMANDE -->
    <div class="modal-overlay-premium" id="modalDemande" style="display:none">
        <div class="modal-premium">
            <div class="modal-header-premium">
                <h3 class="modal-title-premium">üì® Nouvelle demande</h3>
                <button class="modal-close-premium" onclick="closeModalDemande()">‚úï</button>
            </div>
            <form onsubmit="soumettreDemande(event)">
                <div class="modal-body-premium">
                    <div style="background:rgba(245,158,11,0.1);border:1px solid rgba(245,158,11,0.3);border-radius:10px;padding:14px;margin-bottom:20px;display:flex;align-items:start;gap:12px">
                        <span style="font-size:20px;flex-shrink:0">üí°</span>
                        <div style="color:#fbbf24;font-size:13px;line-height:1.5">
                            <strong>Conseil:</strong> Soyez pr√©cis dans votre demande pour obtenir une r√©ponse rapide et adapt√©e.
                        </div>
                    </div>

                    <div class="form-group-premium">
                        <label class="form-label-premium">Destinataire *</label>
                        <select id="demandeDestinataire" name="destinataire" required class="form-input-premium" onchange="updateTypeDemande()">
                            <option value="">S√©lectionner</option>
                            <option value="administration">üèõÔ∏è Administration (Service administratif)</option>
                            <option value="professeur">üë®‚Äçüè´ Professeur (Enseignant sp√©cifique)</option>
                        </select>
                        <div style="font-size:12px;color:rgba(255,255,255,0.5);margin-top:6px">
                            Choisissez qui doit traiter votre demande
                        </div>
                    </div>

                    <div class="form-group-premium" id="groupeProfesseur" style="display:none">
                        <label class="form-label-premium">Professeur concern√© *</label>
                        <select id="demandeProfesseur" name="professeur" class="form-input-premium">
                            <option value="">Chargement...</option>
                        </select>
                        <div style="font-size:12px;color:rgba(255,255,255,0.5);margin-top:6px">
                            Votre demande sera envoy√©e directement √† ce professeur
                        </div>
                    </div>

                    <div class="form-group-premium">
                        <label class="form-label-premium">Type de demande *</label>
                        <select id="demandeType" name="type" required class="form-input-premium">
                            <option value="">S√©lectionner d'abord un destinataire</option>
                        </select>
                    </div>

                    <div class="form-group-premium">
                        <label class="form-label-premium">Objet *</label>
                        <input type="text" name="objet" required class="form-input-premium" placeholder="R√©sum√© de votre demande">
                    </div>

                    <div class="form-group-premium">
                        <label class="form-label-premium">Description *</label>
                        <textarea name="description" required class="form-input-premium" rows="5" placeholder="D√©crivez votre demande en d√©tail..."></textarea>
                    </div>
                </div>
                <div class="modal-footer-premium">
                    <button type="button" class="btn-premium btn-outline" onclick="closeModalDemande()">Annuler</button>
                    <button type="submit" class="btn-premium btn-primary">üì§ Envoyer</button>
                </div>
            </form>
        </div>
    </div>

    <!-- MODAL OBJET PERDU -->
    <div class="modal-overlay-premium" id="modalObjetPerdu" style="display:none">
        <div class="modal-premium">
            <div class="modal-header-premium">
                <h3 class="modal-title-premium">üîç D√©clarer un objet perdu/trouv√©</h3>
                <button class="modal-close-premium" onclick="closeModalObjetPerdu()">‚úï</button>
            </div>
            <form onsubmit="soumettreObjetPerdu(event)">
                <div class="modal-body-premium">
                    <div class="form-group-premium">
                        <label class="form-label-premium">Type *</label>
                        <select name="type" required class="form-input-premium">
                            <option value="perdu">J'ai perdu un objet</option>
                            <option value="trouve">J'ai trouv√© un objet</option>
                        </select>
                    </div>

                    <div class="form-group-premium">
                        <label class="form-label-premium">Nom de l'objet *</label>
                        <input type="text" name="nom_objet" required class="form-input-premium" placeholder="Ex: T√©l√©phone Samsung, Cl√©s, Sac...">
                    </div>

                    <div class="form-group-premium">
                        <label class="form-label-premium">Description *</label>
                        <textarea name="description" required class="form-input-premium" rows="3" placeholder="D√©crivez l'objet (couleur, marque, signes distinctifs...)"></textarea>
                    </div>

                    <div class="form-group-premium">
                        <label class="form-label-premium">Lieu *</label>
                        <input type="text" name="lieu" required class="form-input-premium" placeholder="Ex: Amphith√©√¢tre A, Biblioth√®que, Cantine...">
                    </div>

                    <div class="form-group-premium">
                        <label class="form-label-premium">Date</label>
                        <input type="date" name="date" class="form-input-premium">
                    </div>
                </div>
                <div class="modal-footer-premium">
                    <button type="button" class="btn-premium btn-outline" onclick="closeModalObjetPerdu()">Annuler</button>
                    <button type="submit" class="btn-premium btn-primary">üì§ D√©clarer</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Charger les scripts externes d'abord -->
    <script src="js/mock-data.js?v=10"></script>
    <script src="js/api.js?v=10"></script>
    <script src="js/fix-navigation.js?v=10"></script>
    <script src="js/theme-toggle.js?v=10"></script>

    <!-- Puis le script inline qui utilise ces fonctions -->
    <script>
        // V√©rification d'authentification - DOIT s'ex√©cuter en premier
        (function() {
            // Attendre que Auth soit d√©fini
            function checkAuth() {
                if (typeof Auth === 'undefined') {
                    console.log('‚è≥ En attente du chargement de Auth...');
                    setTimeout(checkAuth, 50);
                    return;
                }

                if (!Auth.isLoggedIn()) {
                    console.log('‚ùå Non connect√©, redirection vers index.html');
                    window.location.replace('index.html');
                    return;
                }

                const user = Auth.getUser();
                if (!user) {
                    console.log('‚ùå Pas de donn√©es utilisateur, redirection vers index.html');
                    Auth.clear();
                    window.location.replace('index.html');
                    return;
                }

                // V√©rifier que l'utilisateur a le r√¥le √©tudiant
                const role = user.role;
                if (role !== 'etudiant') {
                    console.log('‚ùå R√¥le incorrect:', role, '- Redirection vers le bon dashboard');
                    // Rediriger vers le bon dashboard selon le r√¥le
                    if (role === 'admin' || role === 'superadmin' || role === 'administrateur') {
                        window.location.replace('dashboard-admin.html');
                    } else if (role === 'enseignant' || role === 'professeur') {
                        window.location.replace('dashboard-prof.html');
                    } else if (role === 'bureau_executif') {
                        window.location.replace('dashboard-bureau.html');
                    } else {
                        // R√¥le inconnu, d√©connecter
                        Auth.clear();
                        window.location.replace('index.html');
                    }
                    return;
                }

                console.log('‚úÖ Authentification OK - R√¥le:', role);
            }
            
            checkAuth();
        })();

        function navToPremium(page, el) {
            document.querySelectorAll('.erp-page').forEach(p => p.style.display = 'none');
            const target = document.getElementById('page-' + page);
            if (target) target.style.display = 'block';
            
            document.querySelectorAll('.nav-item-premium').forEach(i => i.classList.remove('active'));
            if (el) el.classList.add('active');

            // Charger les donn√©es sp√©cifiques √† la page
            if (page === 'paiements') {
                chargerPaiements();
            } else if (page === 'emploi') {
                chargerEmploi();
            } else if (page === 'supports') {
                chargerSupports();
            } else if (page === 'demande') {
                chargerDemandes();
            } else if (page === 'publications') {
                chargerPublications();
            } else if (page === 'sondage') {
                chargerSondages();
            } else if (page === 'questionnaire') {
                chargerQuestionnaires();
            } else if (page === 'objetperdu') {
                chargerObjetsPerdu();
            } else if (page === 'reclamation') {
                chargerReclamations();
            } else if (page === 'enseignants') {
                chargerMesEnseignants();
            }
        }

        function formatCFA(montant) {
            return new Intl.NumberFormat('fr-FR').format(montant) + ' FCFA';
        }

        function ouvrirReclamation(noteId, matiere, noteCC, noteExamen) {
            // Ouverture depuis une note sp√©cifique (depuis la page notes)
            document.getElementById('reclamationNoteId').value = noteId;
            document.getElementById('reclamationMatiere').value = matiere;
            document.getElementById('reclamationCC').value = noteCC || 'Non saisie';
            document.getElementById('reclamationExamen').value = noteExamen || 'Non saisie';
            
            // Cacher le s√©lecteur, afficher les champs en lecture seule
            document.getElementById('groupeSelectNote').style.display = 'none';
            document.getElementById('groupeMatiereReadonly').style.display = 'block';
            
            const modal = document.getElementById('modalReclamation');
            if (modal) {
                modal.style.display = 'flex';
                document.body.style.overflow = 'hidden';
            }
        }

        function closeModalReclamation() {
            const modal = document.getElementById('modalReclamation');
            if (modal) {
                modal.style.display = 'none';
                document.body.style.overflow = '';
            }
        }

        let notesDisponibles = [];

        async function chargerNotesPourReclamation() {
            try {
                const dashboard = await API.getDashboardEtudiant();
                notesDisponibles = dashboard.notes || [];
                
                const select = document.getElementById('reclamationSelectNote');
                if (notesDisponibles.length === 0) {
                    select.innerHTML = '<option value="">Aucune note disponible</option>';
                    return;
                }
                
                select.innerHTML = '<option value="">S√©lectionner une mati√®re</option>' + 
                    notesDisponibles.map(n => 
                        `<option value="${n.id}" data-matiere="${n.matiere_nom}" data-cc="${n.note_cc || ''}" data-examen="${n.note_examen || ''}">
                            ${n.matiere_nom} - CC: ${n.note_cc || '-'} / Examen: ${n.note_examen || '-'}
                        </option>`
                    ).join('');
                
                // Afficher le s√©lecteur, cacher les champs en lecture seule
                document.getElementById('groupeSelectNote').style.display = 'block';
                document.getElementById('groupeMatiereReadonly').style.display = 'none';
                
                // Vider les champs
                document.getElementById('reclamationNoteId').value = '';
                document.getElementById('reclamationMatiere').value = '';
                document.getElementById('reclamationCC').value = '';
                document.getElementById('reclamationExamen').value = '';
            } catch (err) {
                console.error('Erreur chargement notes:', err);
                showToast('Erreur lors du chargement des notes', 'danger');
            }
        }

        function updateNoteReclamation() {
            const select = document.getElementById('reclamationSelectNote');
            const selectedOption = select.options[select.selectedIndex];
            
            if (selectedOption.value) {
                document.getElementById('reclamationNoteId').value = selectedOption.value;
                document.getElementById('reclamationMatiere').value = selectedOption.dataset.matiere;
                document.getElementById('reclamationCC').value = selectedOption.dataset.cc || 'Non saisie';
                document.getElementById('reclamationExamen').value = selectedOption.dataset.examen || 'Non saisie';
            }
        }

        async function soumettreReclamation(e) {
            e.preventDefault();
            const form = e.target;
            const formData = new FormData(form);
            
            const noteId = document.getElementById('reclamationNoteId').value;
            if (!noteId) {
                showToast('Veuillez s√©lectionner une note', 'warning');
                return;
            }
            
            try {
                const data = {
                    note: parseInt(noteId),
                    type_probleme: formData.get('type_probleme'),
                    description: formData.get('description'),
                    note_attendue: formData.get('note_attendue') || '',
                    statut: 'en_attente'
                };

                // Appel API pour cr√©er la r√©clamation
                const response = await fetch('http://127.0.0.1:8000/api/reclamations/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('erp_access_token')}`
                    },
                    body: JSON.stringify(data)
                });

                if (!response.ok) throw new Error('Erreur lors de l\'envoi');

                showToast('‚úÖ R√©clamation envoy√©e avec succ√®s! L\'enseignant sera notifi√©.', 'success');
                closeModalReclamation();
                form.reset();
                
                // Recharger la liste des r√©clamations si on est sur cette page
                const pageReclamation = document.getElementById('page-reclamation');
                if (pageReclamation && pageReclamation.style.display !== 'none') {
                    chargerReclamations();
                }
            } catch (err) {
                console.error('Erreur:', err);
                showToast('‚ùå Erreur: ' + err.message, 'danger');
            }
        }

        async function chargerDonnees() {
            try {
                const dashboard = await API.getDashboardEtudiant();
                
                // Stats
                document.getElementById('statMatieres').textContent = dashboard.total_matieres || 0;
                document.getElementById('statMoyenne').textContent = (dashboard.moyenne_generale || 0).toFixed(2);
                document.getElementById('statPresence').textContent = (dashboard.taux_presence || 0) + '%';
                document.getElementById('statSolde').textContent = formatCFA(dashboard.solde_du || 0);

                // Notes r√©centes
                if (dashboard.notes && dashboard.notes.length > 0) {
                    const recent = dashboard.notes.slice(0, 5);
                    document.getElementById('tbodyNotes').innerHTML = recent.map(n => `
                        <tr>
                            <td style="font-weight:600">${n.matiere_nom}</td>
                            <td>${n.note_cc || '-'}</td>
                            <td>${n.note_examen || '-'}</td>
                            <td style="font-weight:700;color:${n.moyenne >= 10 ? 'var(--success-600)' : 'var(--danger-600)'}">${n.moyenne ? n.moyenne.toFixed(2) : '-'}</td>
                            <td><span style="background:${n.moyenne >= 10 ? 'var(--success-50)' : 'var(--danger-50)'};color:${n.moyenne >= 10 ? 'var(--success-600)' : 'var(--danger-600)'};padding:4px 8px;border-radius:6px;font-size:12px;font-weight:600">${n.moyenne >= 10 ? 'Valid√©' : 'Non valid√©'}</span></td>
                            <td>
                                <button class="btn-premium btn-outline" style="padding:6px 12px;font-size:12px;" onclick="ouvrirReclamation(${n.id}, '${n.matiere_nom}', '${n.note_cc || ''}', '${n.note_examen || ''}')">
                                    ‚ö†Ô∏è Signaler
                                </button>
                            </td>
                        </tr>
                    `).join('');

                    // Notes compl√®tes
                    document.getElementById('tbodyNotesComplete').innerHTML = dashboard.notes.map(n => `
                        <tr>
                            <td style="font-weight:600">${n.matiere_nom}</td>
                            <td>${n.coefficient || 1}</td>
                            <td>${n.note_cc || '-'}</td>
                            <td>${n.note_examen || '-'}</td>
                            <td style="font-weight:700;color:${n.moyenne >= 10 ? 'var(--success-600)' : 'var(--danger-600)'}">${n.moyenne ? n.moyenne.toFixed(2) : '-'}</td>
                            <td><span style="background:${n.moyenne >= 10 ? 'var(--success-50)' : 'var(--danger-50)'};color:${n.moyenne >= 10 ? 'var(--success-600)' : 'var(--danger-600)'};padding:4px 8px;border-radius:6px;font-size:12px;font-weight:600">${n.moyenne >= 10 ? 'Valid√©' : 'Non valid√©'}</span></td>
                            <td>
                                <button class="btn-premium btn-outline" style="padding:6px 12px;font-size:12px;" onclick="ouvrirReclamation(${n.id}, '${n.matiere_nom}', '${n.note_cc || ''}', '${n.note_examen || ''}')">
                                    ‚ö†Ô∏è Signaler
                                </button>
                            </td>
                        </tr>
                    `).join('');
                } else {
                    document.getElementById('tbodyNotes').innerHTML = '<tr><td colspan="6" style="text-align:center;padding:40px;color:var(--neutral-500)">Aucune note disponible</td></tr>';
                    document.getElementById('tbodyNotesComplete').innerHTML = '<tr><td colspan="7" style="text-align:center;padding:40px;color:var(--neutral-500)">Aucune note disponible</td></tr>';
                }

                // Charts
                creerGraphiques(dashboard);
            } catch (err) {
                console.error('Erreur:', err);
            }
        }

        function creerGraphiques(dashboard) {
            // Chart √©volution notes
            new Chart(document.getElementById('chartNotes'), {
                type: 'line',
                data: {
                    labels: ['S1', 'S2', 'S3', 'S4', 'S5', 'S6'],
                    datasets: [{
                        label: 'Moyenne',
                        data: [12, 13.5, 14, 13, 14.5, dashboard.moyenne_generale || 14],
                        borderColor: '#F59E0B',
                        backgroundColor: 'rgba(245, 158, 11, 0.2)',
                        tension: 0.4,
                        fill: true,
                        pointBackgroundColor: '#F59E0B',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2,
                        pointRadius: 4,
                        pointHoverRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { 
                        legend: { 
                            display: false 
                        },
                        tooltip: {
                            backgroundColor: 'rgba(15, 23, 42, 0.95)',
                            titleColor: '#F59E0B',
                            bodyColor: '#e2e8f0',
                            borderColor: '#F59E0B',
                            borderWidth: 1,
                            padding: 12,
                            displayColors: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 20,
                            grid: {
                                color: 'rgba(148, 163, 184, 0.1)',
                                drawBorder: false
                            },
                            ticks: {
                                color: '#94a3b8'
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            },
                            ticks: {
                                color: '#94a3b8'
                            }
                        }
                    }
                }
            });

            // Chart r√©partition
            new Chart(document.getElementById('chartRepartition'), {
                type: 'doughnut',
                data: {
                    labels: ['Valid√©', 'Non valid√©'],
                    datasets: [{
                        data: [70, 30],
                        backgroundColor: ['#10B981', '#F43F5E'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { 
                        legend: { 
                            position: 'bottom',
                            labels: {
                                color: '#e2e8f0',
                                padding: 15,
                                font: {
                                    size: 12,
                                    weight: '500'
                                }
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(15, 23, 42, 0.95)',
                            titleColor: '#F59E0B',
                            bodyColor: '#e2e8f0',
                            borderColor: '#F59E0B',
                            borderWidth: 1,
                            padding: 12
                        }
                    }
                }
            });
        }

        let tousLesSupports = [];
        let supportsFiltres = [];

        async function chargerPaiements() {
            try {
                const me = await API.getMe();
                const etudiant = me.etudiant;
                
                // Charger les paiements de l'√©tudiant
                const paiements = await API.getPaiements({ etudiant: etudiant.id });
                
                // Calculer les statistiques
                const fraisInscription = etudiant.filiere_frais || 0;
                const montantPaye = paiements
                    .filter(p => p.statut === 'valide')
                    .reduce((sum, p) => sum + parseFloat(p.montant), 0);
                const soldeDu = etudiant.solde_du || 0;

                document.getElementById('statFraisInscription').textContent = formatCFA(fraisInscription);
                document.getElementById('statMontantPaye').textContent = formatCFA(montantPaye);
                document.getElementById('statSoldeDu').textContent = formatCFA(soldeDu);

                // Afficher les paiements
                const tbody = document.getElementById('tbodyPaiements');
                if (paiements.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="7" style="text-align:center;padding:40px;color:rgba(255,255,255,0.5)">Aucun paiement enregistr√©</td></tr>';
                    return;
                }

                const modeLabels = {
                    'especes': 'Esp√®ces',
                    'orange_money': 'Orange Money',
                    'moov_money': 'Moov Money',
                    'virement': 'Virement',
                    'cheque': 'Ch√®que'
                };

                const typeLabels = {
                    'inscription': 'Inscription',
                    'reinscription': 'R√©inscription',
                    'acompte': 'Acompte',
                    'solde': 'Solde',
                    'autre': 'Autre'
                };

                tbody.innerHTML = paiements.map(p => `
                    <tr>
                        <td data-label="N¬∞ Re√ßu" style="font-weight:600">${p.numero_recu}</td>
                        <td data-label="Date">${formatDate(p.date_paiement)}</td>
                        <td data-label="Montant" style="font-weight:600;color:#10b981">${formatCFA(p.montant)}</td>
                        <td data-label="Mode"><span class="badge-ultra primary">${modeLabels[p.mode] || p.mode}</span></td>
                        <td data-label="Type"><span class="badge-ultra warning">${typeLabels[p.type_paiement] || p.type_paiement}</span></td>
                        <td data-label="Statut">
                            <span class="badge-ultra ${p.statut === 'valide' ? 'success' : p.statut === 'rejete' ? 'danger' : 'warning'}">
                                ${p.statut}
                            </span>
                        </td>
                        <td data-label="Action">
                            <button class="btn-premium btn-outline" style="padding:6px 12px;font-size:12px;" onclick="telechargerRecu(${p.id})">
                                üì• Re√ßu
                            </button>
                        </td>
                    </tr>
                `).join('');
            } catch (err) {
                console.error('Erreur:', err);
                document.getElementById('tbodyPaiements').innerHTML = 
                    '<tr><td colspan="7" style="text-align:center;padding:40px;color:rgba(255,255,255,0.5)">Erreur de chargement</td></tr>';
            }
        }

        async function chargerEmploi() {
            try {
                const me = await API.getMe();
                const etudiant = me.etudiant;
                
                // Charger l'emploi du temps de la fili√®re de l'√©tudiant
                const emplois = await API.getEmploisDuTemps({ filiere: etudiant.filiere });
                
                const tbody = document.getElementById('tbodyEmploi');
                if (emplois.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="6" style="text-align:center;padding:40px;color:rgba(255,255,255,0.5)">Aucun cours programm√©</td></tr>';
                    return;
                }

                // Trier par jour et heure
                const joursOrdre = ['Lundi', 'Mardi', 'Mercredi', 'Jeudi', 'Vendredi', 'Samedi'];
                emplois.sort((a, b) => {
                    const jourA = joursOrdre.indexOf(a.jour);
                    const jourB = joursOrdre.indexOf(b.jour);
                    if (jourA !== jourB) return jourA - jourB;
                    return a.heure_debut.localeCompare(b.heure_debut);
                });

                tbody.innerHTML = emplois.map(e => `
                    <tr>
                        <td data-label="Jour" style="font-weight:600">${e.jour}</td>
                        <td data-label="Heure">${e.heure_debut} - ${e.heure_fin}</td>
                        <td data-label="Mati√®re" style="font-weight:600;color:#6366f1">${e.matiere_nom || 'N/A'}</td>
                        <td data-label="Enseignant">${e.enseignant_nom || 'Non assign√©'}</td>
                        <td data-label="Salle"><span class="badge-ultra primary">${e.salle}</span></td>
                        <td data-label="Type"><span class="badge-ultra warning">${e.semaine === 'toutes' ? 'Toutes' : e.semaine}</span></td>
                    </tr>
                `).join('');
            } catch (err) {
                console.error('Erreur:', err);
                document.getElementById('tbodyEmploi').innerHTML = 
                    '<tr><td colspan="6" style="text-align:center;padding:40px;color:rgba(255,255,255,0.5)">Erreur de chargement</td></tr>';
            }
        }

        async function chargerSupports() {
            try {
                const supports = await API.getSupports();
                tousLesSupports = supports;
                supportsFiltres = supports;
                
                afficherSupports();
            } catch (err) {
                console.error('Erreur:', err);
                document.getElementById('tbodySupports').innerHTML = 
                    '<tr><td colspan="6" style="text-align:center;padding:40px;color:rgba(255,255,255,0.5)">Erreur de chargement</td></tr>';
            }
        }

        function filtrerSupports() {
            const searchValue = document.getElementById('searchSupports').value.toLowerCase();
            const filterType = document.getElementById('filterTypeSupport').value;

            supportsFiltres = tousLesSupports.filter(s => {
                const matchSearch = !searchValue || 
                    s.titre.toLowerCase().includes(searchValue) ||
                    s.matiere_nom?.toLowerCase().includes(searchValue) ||
                    s.enseignant_nom?.toLowerCase().includes(searchValue);
                
                const matchType = !filterType || s.type_support === filterType;

                return matchSearch && matchType;
            });

            afficherSupports();
        }

        function afficherSupports() {
            const tbody = document.getElementById('tbodySupports');
            
            if (supportsFiltres.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align:center;padding:40px;color:rgba(255,255,255,0.5)">Aucun support disponible</td></tr>';
                return;
            }

            const typeLabels = {
                'cours': 'Cours',
                'td': 'TD',
                'tp': 'TP',
                'examen_corrige': 'Examen corrig√©',
                'ressource': 'Ressource'
            };

            tbody.innerHTML = supportsFiltres.map(s => `
                <tr>
                    <td data-label="Titre" style="font-weight:600">${s.titre}</td>
                    <td data-label="Mati√®re">${s.matiere_nom || 'N/A'}</td>
                    <td data-label="Enseignant">${s.enseignant_nom || 'N/A'}</td>
                    <td data-label="Type"><span class="badge-ultra primary">${typeLabels[s.type_support] || s.type_support}</span></td>
                    <td data-label="Date">${formatDate(s.date_depot)}</td>
                    <td data-label="Action">
                        <button class="btn-premium btn-outline" style="padding:6px 12px;font-size:12px;" onclick="telechargerSupport(${s.id})">
                            üì• T√©l√©charger
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        function formatDate(dateStr) {
            if (!dateStr) return '‚Äî';
            return new Date(dateStr).toLocaleDateString('fr-FR');
        }

        function telechargerRecu(id) {
            showToast('Fonctionnalit√© de t√©l√©chargement en cours de d√©veloppement', 'info');
        }

        function telechargerSupport(id) {
            showToast('Fonctionnalit√© de t√©l√©chargement en cours de d√©veloppement', 'info');
        }

        function imprimerEmploi() {
            window.print();
        }

        // ========== MES ENSEIGNANTS ==========

        async function chargerMesEnseignants() {
            console.log('üîç Chargement des enseignants...');
            try {
                const dashboard = await API.getDashboardEtudiant();
                console.log('üìä Dashboard re√ßu:', dashboard);
                const notes = dashboard.notes || [];
                console.log('üìù Notes:', notes);
                
                // Grouper les mati√®res par enseignant
                const enseignantsMap = new Map();
                notes.forEach(note => {
                    console.log('Note:', note);
                    if (note.enseignant_id && note.enseignant_nom) {
                        if (!enseignantsMap.has(note.enseignant_id)) {
                            enseignantsMap.set(note.enseignant_id, {
                                id: note.enseignant_id,
                                nom: note.enseignant_nom,
                                matieres: []
                            });
                        }
                        
                        const enseignant = enseignantsMap.get(note.enseignant_id);
                        if (!enseignant.matieres.includes(note.matiere_nom)) {
                            enseignant.matieres.push(note.matiere_nom);
                        }
                    }
                });
                
                console.log('üë®‚Äçüè´ Enseignants trouv√©s:', enseignantsMap.size);
                const mesEnseignants = Array.from(enseignantsMap.values());
                const container = document.getElementById('listeEnseignants');
                
                if (mesEnseignants.length === 0) {
                    console.log('‚ö†Ô∏è Aucun enseignant trouv√©');
                    container.innerHTML = `
                        <div style="grid-column:1/-1;text-align:center;padding:60px">
                            <div style="font-size:48px;margin-bottom:20px;opacity:0.3">üë®‚Äçüè´</div>
                            <h3 style="color:rgba(255,255,255,0.8);margin-bottom:12px;font-size:18px">Aucun enseignant trouv√©</h3>
                            <p style="color:rgba(255,255,255,0.5);font-size:14px;margin-bottom:20px">
                                Vos enseignants appara√Ætront ici une fois que vos notes seront saisies.
                            </p>
                            <div style="padding:16px;background:rgba(245,158,11,0.1);border-radius:10px;border:1px solid rgba(245,158,11,0.2);max-width:500px;margin:0 auto">
                                <div style="font-size:13px;color:rgba(255,255,255,0.7);line-height:1.6">
                                    üí° <strong>Info:</strong> Les enseignants sont automatiquement d√©tect√©s √† partir de vos notes.<br>
                                    Si vous n'avez pas encore de notes, cette liste sera vide.
                                </div>
                            </div>
                        </div>
                    `;
                    return;
                }
                
                console.log('‚úÖ Affichage de', mesEnseignants.length, 'enseignant(s)');
                container.innerHTML = mesEnseignants.map(e => `
                    <div class="card-premium" style="transition:all 0.3s ease">
                        <div class="card-body-premium">
                            <!-- Avatar et nom -->
                            <div style="display:flex;align-items:center;gap:16px;margin-bottom:20px;padding-bottom:20px;border-bottom:1px solid rgba(255,255,255,0.05)">
                                <div style="width:60px;height:60px;border-radius:50%;background:linear-gradient(135deg,#F59E0B,#D97706);display:flex;align-items:center;justify-content:center;font-size:28px;flex-shrink:0;box-shadow:0 4px 12px rgba(245,158,11,0.3)">
                                    üë®‚Äçüè´
                                </div>
                                <div style="flex:1">
                                    <h3 style="font-size:18px;font-weight:700;color:#fff;margin-bottom:4px">${e.nom}</h3>
                                    <div style="font-size:13px;color:rgba(255,255,255,0.6)">
                                        ${e.matieres.length} mati√®re${e.matieres.length > 1 ? 's' : ''}
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Liste des mati√®res -->
                            <div style="margin-bottom:16px">
                                <div style="font-size:12px;color:rgba(255,255,255,0.6);margin-bottom:10px;font-weight:600">MATI√àRES ENSEIGN√âES</div>
                                <div style="display:flex;flex-direction:column;gap:8px">
                                    ${e.matieres.map(m => `
                                        <div style="padding:8px 12px;background:rgba(245,158,11,0.1);border-radius:8px;border:1px solid rgba(245,158,11,0.2);font-size:13px;color:rgba(255,255,255,0.9)">
                                            üìö ${m}
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                            
                            <!-- Actions -->
                            <div style="display:flex;gap:8px">
                                <button class="btn-premium btn-outline" style="flex:1;padding:10px;font-size:13px" onclick="contacterEnseignant(${e.id}, '${e.nom.replace(/'/g, "\\'")}')">
                                    üì® Contacter
                                </button>
                            </div>
                        </div>
                    </div>
                `).join('');
            } catch (err) {
                console.error('‚ùå Erreur chargement enseignants:', err);
                document.getElementById('listeEnseignants').innerHTML = `
                    <div style="grid-column:1/-1;text-align:center;padding:60px">
                        <div style="font-size:48px;margin-bottom:20px;opacity:0.3">‚ö†Ô∏è</div>
                        <h3 style="color:rgba(255,255,255,0.8);margin-bottom:12px;font-size:18px">Erreur de chargement</h3>
                        <p style="color:rgba(255,255,255,0.5);font-size:14px;margin-bottom:20px">
                            Impossible de charger la liste des enseignants.
                        </p>
                        <button class="btn-premium btn-primary" onclick="chargerMesEnseignants()">
                            üîÑ R√©essayer
                        </button>
                    </div>
                `;
            }
        }

        function contacterEnseignant(enseignantId, enseignantNom) {
            // Ouvrir le modal de demande avec le professeur pr√©-s√©lectionn√©
            openModalDemande();
            
            // Attendre que le modal soit ouvert et les professeurs charg√©s
            setTimeout(() => {
                document.getElementById('demandeDestinataire').value = 'professeur';
                updateTypeDemande();
                
                // Attendre que la liste des professeurs soit charg√©e
                setTimeout(() => {
                    document.getElementById('demandeProfesseur').value = enseignantId;
                }, 300);
            }, 100);
        }

        // ========== FONCTIONS SERVICES ==========

        async function chargerDemandes() {
            try {
                const demandes = await API.get('/demandes-administratives/');
                const tbody = document.getElementById('tbodyDemandes');
                
                if (!demandes || demandes.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="6" style="text-align:center;padding:40px;color:rgba(255,255,255,0.5)">Aucune demande pour le moment</td></tr>';
                    return;
                }

                const destinataireLabels = { 'administration': 'Administration', 'professeur': 'Professeur' };
                const statutColors = {
                    'en_attente': 'warning',
                    'en_cours': 'primary',
                    'traitee': 'success',
                    'rejetee': 'danger'
                };

                tbody.innerHTML = demandes.map(d => `
                    <tr>
                        <td>${formatDate(d.date_creation)}</td>
                        <td>
                            <div style="display:flex;flex-direction:column;gap:4px">
                                <span style="font-weight:600">${destinataireLabels[d.destinataire] || d.destinataire}</span>
                                ${d.professeur_nom ? `
                                    <span style="font-size:12px;color:rgba(255,255,255,0.6)">
                                        üë®‚Äçüè´ ${d.professeur_nom}
                                    </span>
                                ` : ''}
                            </div>
                        </td>
                        <td><span class="badge-ultra primary">${d.type}</span></td>
                        <td style="font-weight:600">${d.objet}</td>
                        <td><span class="badge-ultra ${statutColors[d.statut]}">${d.statut.replace('_', ' ')}</span></td>
                        <td>
                            <button class="btn-premium btn-outline" style="padding:6px 12px;font-size:12px;" onclick="voirDetailDemande(${d.id})">
                                üëÅÔ∏è Voir
                            </button>
                        </td>
                    </tr>
                `).join('');
            } catch (err) {
                console.error('Erreur chargement demandes:', err);
                document.getElementById('tbodyDemandes').innerHTML = 
                    '<tr><td colspan="6" style="text-align:center;padding:40px;color:rgba(255,255,255,0.5)">Erreur de chargement</td></tr>';
            }
        }

        async function chargerReclamations() {
            try {
                const reclamations = await API.get('/reclamations/');
                const tbody = document.getElementById('tbodyReclamations');
                
                if (!reclamations || reclamations.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="6" style="text-align:center;padding:40px;color:rgba(255,255,255,0.5)">Aucune r√©clamation</td></tr>';
                    return;
                }

                const typeLabels = {
                    'note_incorrecte': 'Note incorrecte',
                    'note_manquante': 'Note manquante',
                    'mauvaise_matiere': 'Mauvaise mati√®re',
                    'calcul_errone': 'Calcul erron√©',
                    'autre': 'Autre'
                };

                const statutColors = {
                    'en_attente': 'warning',
                    'en_cours': 'primary',
                    'resolue': 'success',
                    'rejetee': 'danger'
                };

                tbody.innerHTML = reclamations.map(r => `
                    <tr>
                        <td>${formatDate(r.date_creation)}</td>
                        <td style="font-weight:600">${r.matiere_nom || 'N/A'}</td>
                        <td><span class="badge-ultra warning">${typeLabels[r.type_probleme] || r.type_probleme}</span></td>
                        <td>${r.description.substring(0, 50)}${r.description.length > 50 ? '...' : ''}</td>
                        <td><span class="badge-ultra ${statutColors[r.statut]}">${r.statut.replace('_', ' ')}</span></td>
                        <td>
                            ${r.reponse_enseignant ? `
                                <button class="btn-premium btn-outline" style="padding:6px 12px;font-size:12px;" onclick="voirReponseReclamation(${r.id})">
                                    üëÅÔ∏è Voir r√©ponse
                                </button>
                            ` : `
                                <span style="color:rgba(255,255,255,0.5);font-size:13px">En attente</span>
                            `}
                        </td>
                    </tr>
                `).join('');
            } catch (err) {
                console.error('Erreur chargement r√©clamations:', err);
                document.getElementById('tbodyReclamations').innerHTML = 
                    '<tr><td colspan="6" style="text-align:center;padding:40px;color:rgba(255,255,255,0.5)">Erreur de chargement</td></tr>';
            }
        }

        async function chargerPublications() {
            try {
                const publications = await API.get('/publications/');
                const container = document.getElementById('listePublications');
                
                if (!publications || publications.length === 0) {
                    container.innerHTML = '<p style="text-align:center;padding:60px;color:rgba(255,255,255,0.5)">Aucune publication</p>';
                    return;
                }

                container.innerHTML = publications.map(p => `
                    <div class="card-premium">
                        <div class="card-body-premium">
                            <div style="display:flex;align-items:start;gap:16px;margin-bottom:12px">
                                <div style="width:48px;height:48px;border-radius:12px;background:linear-gradient(135deg,#6366f1,#a855f7);display:flex;align-items:center;justify-content:center;font-size:24px;flex-shrink:0">
                                    üì∞
                                </div>
                                <div style="flex:1">
                                    <h3 style="font-size:18px;font-weight:700;color:#fff;margin-bottom:6px">${p.titre}</h3>
                                    <div style="display:flex;gap:12px;font-size:13px;color:rgba(255,255,255,0.6)">
                                        <span>üìÖ ${formatDate(p.date_publication)}</span>
                                        <span>üë§ ${p.auteur_nom || 'Bureau Ex√©cutif'}</span>
                                    </div>
                                </div>
                            </div>
                            <p style="color:rgba(255,255,255,0.8);line-height:1.6;margin-bottom:12px">${p.contenu}</p>
                            ${p.fichier ? `<a href="${p.fichier}" target="_blank" class="btn-premium btn-outline" style="display:inline-flex;align-items:center;gap:8px;padding:8px 16px;font-size:13px">üìé Pi√®ce jointe</a>` : ''}
                        </div>
                    </div>
                `).join('');
            } catch (err) {
                console.error('Erreur chargement publications:', err);
                document.getElementById('listePublications').innerHTML = 
                    '<p style="text-align:center;padding:60px;color:rgba(255,255,255,0.5)">Erreur de chargement</p>';
            }
        }

        async function chargerSondages() {
            console.log('üîç Chargement des sondages...');
            try {
                const sondages = await API.get('/sondages/');
                console.log('üìä Sondages re√ßus:', sondages);
                const container = document.getElementById('listeSondages');
                console.log('üì¶ Container trouv√©:', container);
                
                if (!sondages || sondages.length === 0) {
                    console.log('‚ö†Ô∏è Aucun sondage trouv√©');
                    container.innerHTML = '<p style="text-align:center;padding:60px;color:rgba(255,255,255,0.5)">Aucun sondage disponible</p>';
                    return;
                }

                console.log(`‚úÖ ${sondages.length} sondage(s) trouv√©(s)`);
                
                const html = sondages.map(s => {
                    console.log('G√©n√©ration HTML pour:', s.titre);
                    return `
                    <div class="card-premium">
                        <div class="card-body-premium">
                            <div style="display:flex;justify-content:space-between;align-items:start;margin-bottom:16px">
                                <div>
                                    <h3 style="font-size:18px;font-weight:700;color:#fff;margin-bottom:8px">${s.titre}</h3>
                                    <p style="color:rgba(255,255,255,0.6);font-size:14px">${s.description || ''}</p>
                                </div>
                                <span class="badge-ultra ${s.statut === 'actif' ? 'success' : 'danger'}">${s.statut}</span>
                            </div>
                            <div style="display:flex;gap:12px;font-size:13px;color:rgba(255,255,255,0.6);margin-bottom:16px">
                                <span>üìÖ ${formatDate(s.date_debut)} - ${formatDate(s.date_fin)}</span>
                            </div>
                            ${s.statut === 'actif' ? `<button class="btn-premium btn-primary" onclick="participerSondage(${s.id})">Participer</button>` : ''}
                        </div>
                    </div>
                `;
                }).join('');
                
                console.log('üìù HTML g√©n√©r√©, longueur:', html.length);
                container.innerHTML = html;
                console.log('‚úÖ HTML ins√©r√© dans le container');
            } catch (err) {
                console.error('‚ùå Erreur chargement sondages:', err);
                document.getElementById('listeSondages').innerHTML = 
                    '<p style="text-align:center;padding:60px;color:rgba(255,255,255,0.5)">Erreur de chargement</p>';
            }
        }

        async function chargerQuestionnaires() {
            try {
                const evaluations = await API.get('/evaluations/');
                const container = document.getElementById('listeQuestionnaires');
                
                if (!evaluations || evaluations.length === 0) {
                    container.innerHTML = '<p style="text-align:center;padding:60px;color:rgba(255,255,255,0.5)">Aucun questionnaire disponible</p>';
                    return;
                }

                container.innerHTML = evaluations.map(e => `
                    <div class="card-premium">
                        <div class="card-body-premium">
                            <div style="display:flex;justify-content:space-between;align-items:start;margin-bottom:16px">
                                <div>
                                    <h3 style="font-size:18px;font-weight:700;color:#fff;margin-bottom:8px">${e.titre}</h3>
                                    <p style="color:rgba(255,255,255,0.6);font-size:14px">Mati√®re: ${e.matiere_nom || 'N/A'}</p>
                                    <p style="color:rgba(255,255,255,0.6);font-size:14px">Enseignant: ${e.enseignant_nom || 'N/A'}</p>
                                </div>
                                <span class="badge-ultra ${e.actif ? 'success' : 'danger'}">${e.actif ? 'Actif' : 'Ferm√©'}</span>
                            </div>
                            <div style="display:flex;gap:12px;font-size:13px;color:rgba(255,255,255,0.6);margin-bottom:16px">
                                <span>üìÖ ${formatDate(e.date_debut)} - ${formatDate(e.date_fin)}</span>
                            </div>
                            ${e.actif ? `<button class="btn-premium btn-primary" onclick="remplirQuestionnaire(${e.id})">Remplir le questionnaire</button>` : ''}
                        </div>
                    </div>
                `).join('');
            } catch (err) {
                console.error('Erreur chargement questionnaires:', err);
                document.getElementById('listeQuestionnaires').innerHTML = 
                    '<p style="text-align:center;padding:60px;color:rgba(255,255,255,0.5)">Erreur de chargement</p>';
            }
        }

        async function chargerObjetsPerdu() {
            console.log('üîç Chargement des objets perdus...');
            try {
                const objets = await API.get('/objets-perdus/');
                console.log('üì¶ Objets re√ßus:', objets);
                const tbody = document.getElementById('tbodyObjetsPerdu');
                
                if (!objets || objets.length === 0) {
                    console.log('‚ö†Ô∏è Aucun objet trouv√©');
                    tbody.innerHTML = '<tr><td colspan="6" style="text-align:center;padding:40px;color:rgba(255,255,255,0.5)">Aucun objet d√©clar√©</td></tr>';
                    return;
                }

                console.log(`‚úÖ ${objets.length} objet(s) trouv√©(s)`);
                const typeLabels = { 'perdu': 'Perdu', 'trouve': 'Trouv√©' };
                const statutColors = {
                    'actif': 'warning',
                    'recupere': 'success',
                    'archive': 'danger'
                };

                tbody.innerHTML = objets.map(o => `
                    <tr>
                        <td>${formatDate(o.date_declaration)}</td>
                        <td style="font-weight:600">${o.nom_objet}</td>
                        <td>${o.description.substring(0, 40)}${o.description.length > 40 ? '...' : ''}</td>
                        <td>${o.lieu}</td>
                        <td><span class="badge-ultra ${o.type_declaration === 'perdu' ? 'danger' : 'success'}">${typeLabels[o.type_declaration]}</span></td>
                        <td><span class="badge-ultra ${statutColors[o.statut]}">${o.statut}</span></td>
                    </tr>
                `).join('');
            } catch (err) {
                console.error('‚ùå Erreur chargement objets perdus:', err);
                document.getElementById('tbodyObjetsPerdu').innerHTML = 
                    '<tr><td colspan="6" style="text-align:center;padding:40px;color:rgba(255,255,255,0.5)">Erreur de chargement</td></tr>';
            }
        }

        // Fonctions modales
        function openModalReclamation() {
            document.getElementById('modalReclamation').style.display = 'flex';
            document.body.style.overflow = 'hidden';
            chargerNotesPourReclamation();
        }

        function openModalDemande() {
            document.getElementById('modalDemande').style.display = 'flex';
            document.body.style.overflow = 'hidden';
            chargerProfesseursPourDemande();
        }

        function closeModalDemande() {
            document.getElementById('modalDemande').style.display = 'none';
            document.body.style.overflow = '';
        }

        function openModalObjetPerdu() {
            document.getElementById('modalObjetPerdu').style.display = 'flex';
            document.body.style.overflow = 'hidden';
        }

        function closeModalObjetPerdu() {
            document.getElementById('modalObjetPerdu').style.display = 'none';
            document.body.style.overflow = '';
        }

        async function chargerProfesseursPourDemande() {
            try {
                // Charger les notes de l'√©tudiant pour obtenir ses mati√®res et enseignants
                const dashboard = await API.getDashboardEtudiant();
                const notes = dashboard.notes || [];
                
                // Extraire les enseignants uniques de ses mati√®res
                const enseignantsMap = new Map();
                notes.forEach(note => {
                    if (note.enseignant_id && note.enseignant_nom) {
                        enseignantsMap.set(note.enseignant_id, {
                            id: note.enseignant_id,
                            nom: note.enseignant_nom,
                            matiere: note.matiere_nom
                        });
                    }
                });
                
                const mesEnseignants = Array.from(enseignantsMap.values());
                
                const select = document.getElementById('demandeProfesseur');
                
                if (mesEnseignants.length === 0) {
                    select.innerHTML = '<option value="">Aucun enseignant trouv√©</option>';
                    return;
                }
                
                // Grouper par enseignant pour afficher leurs mati√®res
                select.innerHTML = '<option value="">S√©lectionner un professeur</option>' + 
                    mesEnseignants.map(e => {
                        // Trouver toutes les mati√®res de cet enseignant
                        const matieres = notes
                            .filter(n => n.enseignant_id === e.id)
                            .map(n => n.matiere_nom)
                            .filter((v, i, a) => a.indexOf(v) === i); // Unique
                        
                        return `<option value="${e.id}">${e.nom} (${matieres.join(', ')})</option>`;
                    }).join('');
            } catch (err) {
                console.error('Erreur chargement professeurs:', err);
                const select = document.getElementById('demandeProfesseur');
                select.innerHTML = '<option value="">Erreur de chargement</option>';
            }
        }

        function updateTypeDemande() {
            const destinataire = document.getElementById('demandeDestinataire').value;
            const typeSelect = document.getElementById('demandeType');
            const groupeProfesseur = document.getElementById('groupeProfesseur');

            if (destinataire === 'administration') {
                groupeProfesseur.style.display = 'none';
                typeSelect.innerHTML = `
                    <option value="">S√©lectionner</option>
                    <option value="attestation_scolarite">Attestation de scolarit√©</option>
                    <option value="releve_notes">Relev√© de notes</option>
                    <option value="certificat_inscription">Certificat d'inscription</option>
                    <option value="changement_filiere">Changement de fili√®re</option>
                    <option value="report_paiement">Report de paiement</option>
                    <option value="autre">Autre</option>
                `;
            } else if (destinataire === 'professeur') {
                groupeProfesseur.style.display = 'block';
                typeSelect.innerHTML = `
                    <option value="">S√©lectionner</option>
                    <option value="rendez_vous">Demande de rendez-vous</option>
                    <option value="explication_cours">Explication de cours</option>
                    <option value="rattrapage">Demande de rattrapage</option>
                    <option value="support_cours">Support de cours</option>
                    <option value="autre">Autre</option>
                `;
            } else {
                groupeProfesseur.style.display = 'none';
                typeSelect.innerHTML = '<option value="">S√©lectionner d\'abord un destinataire</option>';
            }
        }

        async function soumettreDemande(e) {
            e.preventDefault();
            const form = e.target;
            const formData = new FormData(form);
            
            try {
                const data = {
                    destinataire: formData.get('destinataire'),
                    type: formData.get('type'),
                    objet: formData.get('objet'),
                    description: formData.get('description'),
                    statut: 'en_attente'
                };

                if (formData.get('destinataire') === 'professeur') {
                    data.professeur = parseInt(formData.get('professeur'));
                }

                await API.post('/demandes-administratives/', data);
                showToast('‚úÖ Demande envoy√©e avec succ√®s!', 'success');
                closeModalDemande();
                form.reset();
                chargerDemandes();
            } catch (err) {
                console.error('Erreur:', err);
                showToast('‚ùå Erreur lors de l\'envoi de la demande', 'danger');
            }
        }

        async function soumettreObjetPerdu(e) {
            e.preventDefault();
            const form = e.target;
            const formData = new FormData(form);
            
            try {
                const data = {
                    type_declaration: formData.get('type'),
                    nom_objet: formData.get('nom_objet'),
                    description: formData.get('description'),
                    lieu: formData.get('lieu'),
                    date_perte: formData.get('date') || new Date().toISOString().split('T')[0],
                    contact: Auth.getUser().email,
                    statut: 'actif'
                };

                await API.post('/objets-perdus/', data);
                showToast('‚úÖ Objet d√©clar√© avec succ√®s!', 'success');
                closeModalObjetPerdu();
                form.reset();
                chargerObjetsPerdu();
            } catch (err) {
                console.error('Erreur:', err);
                showToast('‚ùå Erreur lors de la d√©claration', 'danger');
            }
        }

        let demandeSelectionnee = null;

        async function voirDetailDemande(id) {
            try {
                const demandes = await API.get('/demandes-administratives/');
                demandeSelectionnee = demandes.find(d => d.id === id);
                
                if (!demandeSelectionnee) {
                    showToast('Demande introuvable', 'danger');
                    return;
                }

                // Ouvrir le modal de d√©tail
                const modal = document.getElementById('modalDetailDemande');
                if (!modal) {
                    creerModalDetailDemande();
                }
                
                afficherDetailDemande();
            } catch (err) {
                console.error('Erreur:', err);
                showToast('Erreur lors du chargement des d√©tails', 'danger');
            }
        }

        function creerModalDetailDemande() {
            const modalHTML = `
                <div class="modal-overlay-premium" id="modalDetailDemande" style="display:none">
                    <div class="modal-premium" style="max-width:600px">
                        <div class="modal-header-premium">
                            <h3 class="modal-title-premium">üì® D√©tails de la demande</h3>
                            <button class="modal-close-premium" onclick="closeModalDetailDemande()">‚úï</button>
                        </div>
                        <div class="modal-body-premium" id="modalDetailDemandeBody">
                            <!-- Contenu dynamique -->
                        </div>
                        <div class="modal-footer-premium">
                            <button type="button" class="btn-premium btn-outline" onclick="closeModalDetailDemande()">Fermer</button>
                        </div>
                    </div>
                </div>
            `;
            document.body.insertAdjacentHTML('beforeend', modalHTML);
        }

        function afficherDetailDemande() {
            const modal = document.getElementById('modalDetailDemande');
            const body = document.getElementById('modalDetailDemandeBody');
            
            if (!demandeSelectionnee) return;

            const destinataireLabels = { 'administration': 'Administration', 'professeur': 'Professeur' };
            const statutColors = {
                'en_attente': 'warning',
                'en_cours': 'primary',
                'traitee': 'success',
                'rejetee': 'danger'
            };
            const statutLabels = {
                'en_attente': 'En attente',
                'en_cours': 'En cours de traitement',
                'traitee': 'Trait√©e',
                'rejetee': 'Rejet√©e'
            };

            body.innerHTML = `
                <div style="display:grid;gap:20px">
                    <!-- Informations g√©n√©rales -->
                    <div style="padding:16px;background:rgba(255,255,255,0.03);border-radius:10px;border:1px solid rgba(255,255,255,0.1)">
                        <div style="display:grid;gap:12px">
                            <div>
                                <div style="font-size:12px;color:rgba(255,255,255,0.6);margin-bottom:4px">DESTINATAIRE</div>
                                <div style="font-weight:600;color:#fff">${destinataireLabels[demandeSelectionnee.destinataire] || demandeSelectionnee.destinataire}</div>
                                ${demandeSelectionnee.professeur_nom ? `
                                    <div style="font-size:13px;color:rgba(255,255,255,0.7);margin-top:4px">
                                        üë®‚Äçüè´ ${demandeSelectionnee.professeur_nom}
                                    </div>
                                ` : ''}
                            </div>
                            <div>
                                <div style="font-size:12px;color:rgba(255,255,255,0.6);margin-bottom:4px">TYPE</div>
                                <div><span class="badge-ultra primary">${demandeSelectionnee.type}</span></div>
                            </div>
                            <div>
                                <div style="font-size:12px;color:rgba(255,255,255,0.6);margin-bottom:4px">DATE DE CR√âATION</div>
                                <div style="color:#fff">${formatDate(demandeSelectionnee.date_creation)}</div>
                            </div>
                            <div>
                                <div style="font-size:12px;color:rgba(255,255,255,0.6);margin-bottom:4px">STATUT</div>
                                <div><span class="badge-ultra ${statutColors[demandeSelectionnee.statut]}">${statutLabels[demandeSelectionnee.statut]}</span></div>
                            </div>
                        </div>
                    </div>

                    <!-- Objet -->
                    <div>
                        <div style="font-size:12px;color:rgba(255,255,255,0.6);margin-bottom:8px;font-weight:600">OBJET</div>
                        <div style="padding:12px;background:rgba(255,255,255,0.03);border-radius:8px;color:#fff">${demandeSelectionnee.objet}</div>
                    </div>

                    <!-- Description -->
                    <div>
                        <div style="font-size:12px;color:rgba(255,255,255,0.6);margin-bottom:8px;font-weight:600">DESCRIPTION</div>
                        <div style="padding:12px;background:rgba(255,255,255,0.03);border-radius:8px;color:rgba(255,255,255,0.8);line-height:1.6">${demandeSelectionnee.description}</div>
                    </div>

                    <!-- R√©ponse (si disponible) -->
                    ${demandeSelectionnee.reponse ? `
                        <div style="padding:16px;background:rgba(16,185,129,0.1);border-radius:10px;border:1px solid rgba(16,185,129,0.3)">
                            <div style="display:flex;align-items:center;gap:8px;margin-bottom:12px">
                                <span style="font-size:20px">üí¨</span>
                                <div style="font-size:14px;font-weight:700;color:#10b981">
                                    R√âPONSE ${demandeSelectionnee.destinataire === 'professeur' && demandeSelectionnee.professeur_nom ? 
                                        'DE ' + demandeSelectionnee.professeur_nom.toUpperCase() : 
                                        'DE L\'ADMINISTRATION'}
                                </div>
                            </div>
                            <div style="color:rgba(255,255,255,0.9);line-height:1.6">${demandeSelectionnee.reponse}</div>
                            ${demandeSelectionnee.date_reponse ? `
                                <div style="margin-top:12px;font-size:12px;color:rgba(255,255,255,0.6)">
                                    R√©pondu le ${formatDate(demandeSelectionnee.date_reponse)}
                                </div>
                            ` : ''}
                        </div>
                    ` : demandeSelectionnee.statut === 'en_attente' ? `
                        <div style="padding:16px;background:rgba(245,158,11,0.1);border-radius:10px;border:1px solid rgba(245,158,11,0.3)">
                            <div style="display:flex;align-items:center;gap:8px;color:#fbbf24">
                                <span style="font-size:20px">‚è≥</span>
                                <div style="font-size:14px;font-weight:600">
                                    Votre demande est en attente de traitement${demandeSelectionnee.destinataire === 'professeur' && demandeSelectionnee.professeur_nom ? 
                                        ' par ' + demandeSelectionnee.professeur_nom : 
                                        ' par l\'administration'}
                                </div>
                            </div>
                        </div>
                    ` : demandeSelectionnee.statut === 'en_cours' ? `
                        <div style="padding:16px;background:rgba(99,102,241,0.1);border-radius:10px;border:1px solid rgba(99,102,241,0.3)">
                            <div style="display:flex;align-items:center;gap:8px;color:#6366f1">
                                <span style="font-size:20px">üîÑ</span>
                                <div style="font-size:14px;font-weight:600">
                                    Votre demande est en cours de traitement${demandeSelectionnee.destinataire === 'professeur' && demandeSelectionnee.professeur_nom ? 
                                        ' par ' + demandeSelectionnee.professeur_nom : 
                                        ' par l\'administration'}
                                </div>
                            </div>
                        </div>
                    ` : ''}
                </div>
            `;

            modal.style.display = 'flex';
            document.body.style.overflow = 'hidden';
        }

        function closeModalDetailDemande() {
            const modal = document.getElementById('modalDetailDemande');
            if (modal) {
                modal.style.display = 'none';
                document.body.style.overflow = '';
            }
        }

        // ========== R√âCLAMATIONS - D√âTAILS ==========

        let reclamationSelectionnee = null;

        async function voirReponseReclamation(id) {
            try {
                const reclamations = await API.get('/reclamations/');
                reclamationSelectionnee = reclamations.find(r => r.id === id);
                
                if (!reclamationSelectionnee) {
                    showToast('R√©clamation introuvable', 'danger');
                    return;
                }

                // Ouvrir le modal de d√©tail
                const modal = document.getElementById('modalDetailReclamation');
                if (!modal) {
                    creerModalDetailReclamation();
                }
                
                afficherDetailReclamation();
            } catch (err) {
                console.error('Erreur:', err);
                showToast('Erreur lors du chargement des d√©tails', 'danger');
            }
        }

        function creerModalDetailReclamation() {
            const modalHTML = `
                <div class="modal-overlay-premium" id="modalDetailReclamation" style="display:none">
                    <div class="modal-premium" style="max-width:700px">
                        <div class="modal-header-premium">
                            <h3 class="modal-title-premium">üì¢ D√©tails de la r√©clamation</h3>
                            <button class="modal-close-premium" onclick="closeModalDetailReclamation()">‚úï</button>
                        </div>
                        <div class="modal-body-premium" id="modalDetailReclamationBody">
                            <!-- Contenu dynamique -->
                        </div>
                        <div class="modal-footer-premium">
                            <button type="button" class="btn-premium btn-outline" onclick="closeModalDetailReclamation()">Fermer</button>
                        </div>
                    </div>
                </div>
            `;
            document.body.insertAdjacentHTML('beforeend', modalHTML);
        }

        function afficherDetailReclamation() {
            const modal = document.getElementById('modalDetailReclamation');
            const body = document.getElementById('modalDetailReclamationBody');
            
            if (!reclamationSelectionnee) return;

            const typeLabels = {
                'note_incorrecte': 'Note incorrecte / erreur de saisie',
                'note_manquante': 'Note manquante',
                'mauvaise_matiere': 'Note attribu√©e √† la mauvaise mati√®re',
                'calcul_errone': 'Erreur de calcul de moyenne',
                'autre': 'Autre probl√®me'
            };

            const statutColors = {
                'en_attente': 'warning',
                'en_cours': 'primary',
                'resolue': 'success',
                'rejetee': 'danger'
            };

            const statutLabels = {
                'en_attente': 'En attente',
                'en_cours': 'En cours de traitement',
                'resolue': 'R√©solue',
                'rejetee': 'Rejet√©e'
            };

            const decisionLabels = {
                'accepter': 'Accept√©e',
                'rejeter': 'Rejet√©e',
                'en_cours': 'En cours'
            };

            body.innerHTML = `
                <div style="display:grid;gap:20px">
                    <!-- Informations g√©n√©rales -->
                    <div style="padding:16px;background:rgba(255,255,255,0.03);border-radius:10px;border:1px solid rgba(255,255,255,0.1)">
                        <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px">
                            <div>
                                <div style="font-size:12px;color:rgba(255,255,255,0.6);margin-bottom:4px">MATI√àRE</div>
                                <div style="font-weight:600;color:#fff">${reclamationSelectionnee.matiere_nom || 'N/A'}</div>
                            </div>
                            <div>
                                <div style="font-size:12px;color:rgba(255,255,255,0.6);margin-bottom:4px">ENSEIGNANT</div>
                                <div style="color:#fff">${reclamationSelectionnee.enseignant_nom || 'N/A'}</div>
                            </div>
                            <div>
                                <div style="font-size:12px;color:rgba(255,255,255,0.6);margin-bottom:4px">DATE DE CR√âATION</div>
                                <div style="color:#fff">${formatDate(reclamationSelectionnee.date_creation)}</div>
                            </div>
                            <div>
                                <div style="font-size:12px;color:rgba(255,255,255,0.6);margin-bottom:4px">STATUT</div>
                                <div><span class="badge-ultra ${statutColors[reclamationSelectionnee.statut]}">${statutLabels[reclamationSelectionnee.statut]}</span></div>
                            </div>
                        </div>
                    </div>

                    <!-- Notes -->
                    <div style="padding:16px;background:rgba(99,102,241,0.1);border-radius:10px;border:1px solid rgba(99,102,241,0.3)">
                        <div style="font-size:14px;font-weight:700;color:#6366f1;margin-bottom:12px">üìä NOTES CONCERN√âES</div>
                        <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px">
                            <div>
                                <div style="font-size:12px;color:rgba(255,255,255,0.6);margin-bottom:4px">NOTE CC</div>
                                <div style="font-size:18px;font-weight:700;color:#fff">${reclamationSelectionnee.note_cc || '-'}/20</div>
                            </div>
                            <div>
                                <div style="font-size:12px;color:rgba(255,255,255,0.6);margin-bottom:4px">NOTE EXAMEN</div>
                                <div style="font-size:18px;font-weight:700;color:#fff">${reclamationSelectionnee.note_examen || '-'}/20</div>
                            </div>
                            <div>
                                <div style="font-size:12px;color:rgba(255,255,255,0.6);margin-bottom:4px">MOYENNE</div>
                                <div style="font-size:18px;font-weight:700;color:#fff">${reclamationSelectionnee.moyenne || '-'}/20</div>
                            </div>
                        </div>
                    </div>

                    <!-- Type de probl√®me -->
                    <div>
                        <div style="font-size:12px;color:rgba(255,255,255,0.6);margin-bottom:8px;font-weight:600">TYPE DE PROBL√àME</div>
                        <div><span class="badge-ultra warning">${typeLabels[reclamationSelectionnee.type_probleme] || reclamationSelectionnee.type_probleme}</span></div>
                    </div>

                    <!-- Description -->
                    <div>
                        <div style="font-size:12px;color:rgba(255,255,255,0.6);margin-bottom:8px;font-weight:600">VOTRE DESCRIPTION</div>
                        <div style="padding:12px;background:rgba(255,255,255,0.03);border-radius:8px;color:rgba(255,255,255,0.8);line-height:1.6">${reclamationSelectionnee.description}</div>
                    </div>

                    ${reclamationSelectionnee.note_attendue ? `
                        <div>
                            <div style="font-size:12px;color:rgba(255,255,255,0.6);margin-bottom:8px;font-weight:600">NOTE ATTENDUE</div>
                            <div style="padding:12px;background:rgba(255,255,255,0.03);border-radius:8px;color:rgba(255,255,255,0.8)">${reclamationSelectionnee.note_attendue}</div>
                        </div>
                    ` : ''}

                    <!-- R√©ponse de l'enseignant -->
                    ${reclamationSelectionnee.reponse_enseignant ? `
                        <div style="padding:16px;background:${reclamationSelectionnee.statut === 'resolue' ? 'rgba(16,185,129,0.1)' : 'rgba(239,68,68,0.1)'};border-radius:10px;border:1px solid ${reclamationSelectionnee.statut === 'resolue' ? 'rgba(16,185,129,0.3)' : 'rgba(239,68,68,0.3)'}">
                            <div style="display:flex;align-items:center;gap:8px;margin-bottom:12px">
                                <span style="font-size:20px">${reclamationSelectionnee.statut === 'resolue' ? '‚úÖ' : '‚ùå'}</span>
                                <div style="font-size:14px;font-weight:700;color:${reclamationSelectionnee.statut === 'resolue' ? '#10b981' : '#ef4444'}">
                                    R√âPONSE DE L'ENSEIGNANT
                                    ${reclamationSelectionnee.decision ? ` - ${decisionLabels[reclamationSelectionnee.decision] || reclamationSelectionnee.decision}` : ''}
                                </div>
                            </div>
                            <div style="color:rgba(255,255,255,0.9);line-height:1.6;margin-bottom:12px">${reclamationSelectionnee.reponse_enseignant}</div>
                            
                            ${reclamationSelectionnee.nouvelle_note_cc || reclamationSelectionnee.nouvelle_note_examen ? `
                                <div style="margin-top:16px;padding-top:16px;border-top:1px solid rgba(255,255,255,0.1)">
                                    <div style="font-size:12px;color:rgba(255,255,255,0.6);margin-bottom:8px;font-weight:600">NOTES CORRIG√âES</div>
                                    <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px">
                                        ${reclamationSelectionnee.nouvelle_note_cc ? `
                                            <div>
                                                <div style="font-size:11px;color:rgba(255,255,255,0.5);margin-bottom:4px">NOUVELLE NOTE CC</div>
                                                <div style="font-size:16px;font-weight:700;color:#10b981">${reclamationSelectionnee.nouvelle_note_cc}/20</div>
                                            </div>
                                        ` : ''}
                                        ${reclamationSelectionnee.nouvelle_note_examen ? `
                                            <div>
                                                <div style="font-size:11px;color:rgba(255,255,255,0.5);margin-bottom:4px">NOUVELLE NOTE EXAMEN</div>
                                                <div style="font-size:16px;font-weight:700;color:#10b981">${reclamationSelectionnee.nouvelle_note_examen}/20</div>
                                            </div>
                                        ` : ''}
                                        ${reclamationSelectionnee.nouvelle_moyenne ? `
                                            <div>
                                                <div style="font-size:11px;color:rgba(255,255,255,0.5);margin-bottom:4px">NOUVELLE MOYENNE</div>
                                                <div style="font-size:16px;font-weight:700;color:#10b981">${reclamationSelectionnee.nouvelle_moyenne}/20</div>
                                            </div>
                                        ` : ''}
                                    </div>
                                </div>
                            ` : ''}
                            
                            ${reclamationSelectionnee.date_traitement ? `
                                <div style="margin-top:12px;font-size:12px;color:rgba(255,255,255,0.6)">
                                    Trait√©e le ${formatDate(reclamationSelectionnee.date_traitement)}
                                </div>
                            ` : ''}
                        </div>
                    ` : reclamationSelectionnee.statut === 'en_attente' ? `
                        <div style="padding:16px;background:rgba(245,158,11,0.1);border-radius:10px;border:1px solid rgba(245,158,11,0.3)">
                            <div style="display:flex;align-items:center;gap:8px;color:#fbbf24">
                                <span style="font-size:20px">‚è≥</span>
                                <div style="font-size:14px;font-weight:600">Votre r√©clamation est en attente de traitement par l'enseignant</div>
                            </div>
                        </div>
                    ` : reclamationSelectionnee.statut === 'en_cours' ? `
                        <div style="padding:16px;background:rgba(99,102,241,0.1);border-radius:10px;border:1px solid rgba(99,102,241,0.3)">
                            <div style="display:flex;align-items:center;gap:8px;color:#6366f1">
                                <span style="font-size:20px">üîÑ</span>
                                <div style="font-size:14px;font-weight:600">Votre r√©clamation est en cours de traitement</div>
                            </div>
                        </div>
                    ` : ''}
                </div>
            `;

            modal.style.display = 'flex';
            document.body.style.overflow = 'hidden';
        }

        function closeModalDetailReclamation() {
            const modal = document.getElementById('modalDetailReclamation');
            if (modal) {
                modal.style.display = 'none';
                document.body.style.overflow = '';
            }
        }

        function participerSondage(id) {
            showToast('Fonctionnalit√© en cours de d√©veloppement', 'info');
        }

        function remplirQuestionnaire(id) {
            showToast('Fonctionnalit√© en cours de d√©veloppement', 'info');
        }

        function showToast(message, type = 'info') {
            const icons = { success: '‚úÖ', danger: '‚ùå', warning: '‚ö†Ô∏è', info: '‚ÑπÔ∏è' };
            let container = document.getElementById('toast-container');
            if (!container) {
                container = document.createElement('div');
                container.id = 'toast-container';
                container.style.cssText = 'position:fixed;top:20px;right:20px;z-index:9999;display:flex;flex-direction:column;gap:10px;';
                document.body.appendChild(container);
            }
            const toast = document.createElement('div');
            const colors = { success: '#059669', danger: '#dc2626', warning: '#d97706', info: '#2563eb' };
            toast.style.cssText = `background:rgba(10,14,39,0.95);border-radius:12px;padding:14px 18px;box-shadow:0 8px 32px rgba(0,0,0,.3);display:flex;align-items:center;gap:12px;min-width:280px;max-width:400px;border-left:4px solid ${colors[type]};animation:slideIn .3s ease;backdrop-filter:blur(10px);border:1px solid rgba(255,255,255,0.1)`;
            toast.innerHTML = `<span style="font-size:18px">${icons[type]}</span><span style="font-size:14px;font-weight:500;flex:1;color:#fff">${message}</span><span onclick="this.parentElement.remove()" style="cursor:pointer;color:#94a3b8;flex-shrink:0;font-size:18px">‚úï</span>`;
            container.appendChild(toast);
            setTimeout(() => { if (toast.parentElement) toast.remove(); }, 3500);
        }

        document.addEventListener('DOMContentLoaded', function() {
            const user = requireAuth(['etudiant']);
            if (user) {
                chargerDonnees();
            }
        });
    </script>
</body>
</html>
