✅ CORRECTION DES PERMISSIONS API
==================================

PROBLÈME IDENTIFIÉ:
===================

Erreur 403 (Forbidden) sur /api/evaluations/
Message: "Vous n'avez pas la permission d'effectuer cette action"

Cause: EvaluationViewSet avait permission_classes = [IsEnseignant]
Les étudiants ne pouvaient pas accéder aux questionnaires d'évaluation

CORRECTION APPORTÉE:
====================

Fichier: backend/api/views.py
ViewSet: EvaluationViewSet

AVANT:
------
permission_classes = [IsEnseignant]

APRÈS:
------
permission_classes = [IsAuthenticated]

+ Ajout de get_permissions() pour différencier:
  - Lecture (GET): Tous les utilisateurs authentifiés
  - Écriture (POST/PUT/DELETE): Seulement les enseignants

+ Ajout de filtrage pour les étudiants dans get_queryset():
  - Les étudiants voient seulement les évaluations actives
  - Filtrées par leur filière
  - Les enseignants voient leurs propres évaluations

CODE AJOUTÉ:
============

```python
def get_queryset(self):
    # ... code existant ...
    
    # Étudiant voit les évaluations actives de ses matières
    elif self.request.user.role == 'etudiant':
        try:
            etudiant = self.request.user.etudiant
            qs = qs.filter(
                matiere__filiere=etudiant.filiere,
                actif=True
            )
        except: qs = qs.none()
    
    return qs

def get_permissions(self):
    # Seuls les enseignants peuvent créer/modifier/supprimer
    if self.action in ['create', 'update', 'partial_update', 'destroy']:
        return [IsEnseignant()]
    return [IsAuthenticated()]
```

RÉSULTAT:
=========

✅ Les étudiants peuvent maintenant accéder à /api/evaluations/
✅ Ils voient seulement les évaluations actives de leur filière
✅ Les enseignants gardent leurs permissions de création/modification
✅ La page "Questionnaires" fonctionne maintenant

AUTRES VIEWSETS VÉRIFIÉS:
==========================

✅ PublicationViewSet: permissions.IsAuthenticated (OK)
✅ SondageViewSet: permissions.IsAuthenticated (OK)
✅ DemandeAdministrativeViewSet: Filtré par étudiant (OK)
✅ ObjetPerduViewSet: permissions.IsAuthenticated (OK)

SERVEUR REDÉMARRÉ:
==================

✅ Django server redémarré sur http://127.0.0.1:8000/
✅ Changements de permissions pris en compte

INSTRUCTIONS:
=============

1. Rechargez la page dans votre navigateur (F5 ou Ctrl+R)
2. Videz le cache si nécessaire (Ctrl+F5)
3. Testez la page "Questionnaires" dans Services
4. Vous devriez maintenant voir les évaluations disponibles

Date: 26 février 2026
